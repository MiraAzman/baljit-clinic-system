CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_TRX_Bill`(
IN sMethod			varchar(30),
IN sBLS_IDX			INTEGER,
IN sBLS_BillNo		VARCHAR(10),
IN sBLS_EntryNo		INTEGER,
IN sBLS_VisitDate	VARCHAR(30),
IN sBLS_QNo			INTEGER,
IN sBLS_QIDX		INTEGER,
IN sBLS_ShiftCode	VARCHAR(6),
IN sBLS_BillEntryNo	INTEGER,
IN sBLS_IsCorporate	VARCHAR(1),
IN sBLS_CSHCNFEE	NUMERIC(15,3),
IN sBLS_CSHMEDFEE	NUMERIC(15,3),
IN sBLS_CSHINVFEE	NUMERIC(15,3),
IN sBLS_CSHTRMFEE	NUMERIC(15,3),
IN sBLS_CSHEXMFEE	NUMERIC(15,3),
IN sBLS_CSHSURFEE	NUMERIC(15,3),
IN sBLS_CSHOTHFEE	NUMERIC(15,3),
IN sBLS_CSHTOTAL	NUMERIC(15,3),
IN sBLS_PartialCash	NUMERIC(15,3),
IN sBLS_INVCNFEE	NUMERIC(15,3),
IN sBLS_INVMEDFEE	NUMERIC(15,3),
IN sBLS_INVINVFEE	NUMERIC(15,3),
IN sBLS_INVTRMFEE	NUMERIC(15,3),
IN sBLS_INVEXMFEE	NUMERIC(15,3),
IN sBLS_INVSURFEE	NUMERIC(15,3),
IN sBLS_INVOTHFEE	NUMERIC(15,3),
IN sBLS_INVTOTAL	NUMERIC(15,3),
IN sBLS_TaxAmt		NUMERIC(15,3),
IN sBLS_HealthPlanCode		VARCHAR(10),
IN sBLS_CorPayType	VARCHAR(10),
IN sBLS_CorporatePay		NUMERIC(15,3),
IN sBLS_HPPatientPay		NUMERIC(15,3),
IN sBLS_HPPatientPayPercent	NUMERIC(15,3),
IN sBLS_HPCorPay	NUMERIC(15,3),
IN sBLS_HPCorPayPercent		NUMERIC(15,3),
IN sBLS_Invoiced	VARCHAR(1),
IN sBLS_InvoiceNo	VARCHAR(10),
IN sBLS_InvHeaderIDX		INTEGER,
IN sBLS_MedicalExceed		VARCHAR(1),
IN sBLS_PRNTime		INTEGER,
IN sBLS_DoctorID	VARCHAR(10),
IN sBLS_BillPanelCD	VARCHAR(10),
IN sBLS_BillPanelNM	VARCHAR(100),
IN sBLS_BillChitNo	VARCHAR(10),
IN sBLS_MCIdx		INTEGER,
IN sBLS_InvSeqNo	INTEGER,
IN sBLS_PaidAmt		NUMERIC(15,3),
IN sBLS_Remark		VARCHAR(100),
IN sBLS_FreeChar1	VARCHAR(1),
IN sBLS_InvCode		VARCHAR(20),
IN sBLS_CSHCNFEEDESC		VARCHAR(50),
IN sBLS_INVCNFEEDESC		VARCHAR(50),
IN sBLS_DiscountAmtCash		NUMERIC(15,3),
IN sBLS_DiscountAmtCorp		VARCHAR(10),
IN sBLS_CSHPKGFEE	NUMERIC(15,3),
IN sBLS_INVPKGFEE	NUMERIC(15,3),
IN sBLS_RoundAmt	NUMERIC(15,3),
IN sBLS_CSHTAX		NUMERIC(15,3),
IN sBLS_Credit		NUMERIC(15,3),
IN sBLS_Confirm		VARCHAR(1),
IN sBLS_Debit		NUMERIC(15,3),
IN sBLS_Type		VARCHAR(3),
IN sBLS_RefID		VARCHAR(10),
IN sBLS_DBTPaid		NUMERIC(15,3),
IN sBLS_DiscountPerc		NUMERIC(15,3),
IN sBLS_DiscountInv	NUMERIC(15,3),
IN sBLS_DiscountInvPerc		NUMERIC(15,3),
IN sBLS_IsCategoryTRSF		VARCHAR(1),
IN sBLS_Refund		NUMERIC(15,3),
IN sBLS_CreditInv	NUMERIC(15,3),
IN sBLS_DebitInv	NUMERIC(15,3),
IN sBLS_Deposit		NUMERIC(15,3),
IN sBLS_OTCRemark	VARCHAR(100),
IN sBLS_CSHPRODFEE	NUMERIC(15,3),
IN sBLS_INVPRODFEE	NUMERIC(15,3),
IN sBLS_ControlUserID		VARCHAR(10),
IN sBLS_SaleDept	VARCHAR(10),
IN sBLS_BillStatus	VARCHAR(6),
IN sBLS_Company		VARCHAR(100),
IN sBLS_Branch		VARCHAR(100),
IN sBLS_Telemarketer		VARCHAR(100),
IN sBLS_Voucher		VARCHAR(100),
IN sBLS_Doctor		VARCHAR(100),
IN sBLS_SalesPerson	VARCHAR(300),
IN sBLS_SalesPersonValue	VARCHAR(300),
IN sBLS_Blood		VARCHAR(100),
IN sBLS_RoundAmtInv	NUMERIC(15,3),
IN sBLS_PaidAmtInv	NUMERIC(15,3),
IN sBLS_JNAccGen	VARCHAR(1),
IN sBLS_JNAccPosted	VARCHAR(1),
IN sBLS_RecordNo	VARCHAR(20),
IN sBLS_CSHGSTAMT	NUMERIC(15,3),
IN sBLS_INVGSTAMT	NUMERIC(15,3),
IN sBLS_CSHGROSSTOTAL		NUMERIC(15,3),
IN sBLS_INVGROSSTOTAL		NUMERIC(15,3),
IN sBLS_GSTInclusive		VARCHAR(1),

IN sBLD_IDX			INTEGER,
IN sBLD_CHGIDX		INTEGER,
IN sBLD_Category	VARCHAR(6),
IN sBLD_CHGGrp		VARCHAR(10),
IN sBLD_CHGDesc		VARCHAR(100),
IN sBLD_UOM			VARCHAR(6),
IN sBLD_Factor		NUMERIC(15,3),
IN sBLD_Qty			NUMERIC(15,3),
IN sBLD_UnitPrice	NUMERIC(15,3),
IN sBLD_TotalPrice	NUMERIC(15,3),
IN sBLD_Audit		VARCHAR(1),
IN sBLD_IsRestricted		VARCHAR(1),
IN sBLD_IsPsychotropic		VARCHAR(1),
IN sBLD_Remark		VARCHAR(100),
IN sBLD_Frequency	VARCHAR(100),
IN sBLD_Instruction	VARCHAR(100),
IN sBLD_Indication	VARCHAR(100),
IN sBLD_Dosage		VARCHAR(100),
IN sBLD_DocID		VARCHAR(10),
IN sBLD_DocName		VARCHAR(50),
IN sBLD_DispenseBy	VARCHAR(10),
IN sBLD_DispenseDate		VARCHAR(30),
IN sBLD_PriintLabel	VARCHAR(1),
IN sBLD_IsRemoveItem		VARCHAR(1),
IN sBLD_ChitNum		VARCHAR(10),
IN sBLD_Precaution	VARCHAR(100),
IN sBLD_Commited	VARCHAR(1),
IN sBLD_CommitQty	NUMERIC(15,3),
IN sBLD_CommitFactor		NUMERIC(15,3),
IN sBLD_CommitPrice	NUMERIC(15,3),
IN sBLD_CommitUOMIdx		INTEGER,
IN sBLD_UOMIdx		INTEGER,
IN sBLD_BSBillNo	VARCHAR(10),
IN sBLD_RecordStat	VARCHAR(6),
IN sBLD_CHGCode		VARCHAR(16),
IN sBLD_PayCash		VARCHAR(1),
IN sBLD_DrugMixInd	VARCHAR(1),
IN sBLD_CommisionID	VARCHAR(10),
IN sBLD_CommisionScheme		VARCHAR(10),
IN sBLD_DiscountAmt	NUMERIC(15,3),
IN sBLD_DiscountPerc		NUMERIC(15,3),
IN sBLD_TotalBfDis	NUMERIC(15,3),
IN sBLD_Dept		VARCHAR(3),
IN sBLD_DrugReturn	VARCHAR(1),
IN sBLD_StockType	VARCHAR(1),
IN sBLD_ShiftCloseDate		VARCHAR(30),
IN sBLD_Status		VARCHAR(2),
IN sBLD_HomeDrug	VARCHAR(3),
IN sBLD_DayWard		VARCHAR(3),
IN sBLD_Type		VARCHAR(3),
IN sBLD_RefID		VARCHAR(10),
IN sBLD_ReportGrp	VARCHAR(6),
IN sBLD_ReportGrpSeq		VARCHAR(10),
IN sBLD_Laborder	INTEGER,
IN sBLD_AvgCostUOM	VARCHAR(6),
IN sBLD_AvgCostBaseUOM		NUMERIC(15,3),
IN sBLD_StkDisLoc	VARCHAR(10),
IN sBLD_IMMIDX		INTEGER,
IN sBLD_PKGIDX		INTEGER,
IN sBLD_RefundByCash		VARCHAR(1),
IN sBLD_RecordNo	VARCHAR(20),
IN sBLD_DrugInd		VARCHAR(1),
IN sBLD_ChargeInd	VARCHAR(2),
IN sBLD_InitialUnitPrice	NUMERIC(15,3),
IN sBLD_UsedTime	INTEGER,
IN sBLD_CSRIDX		INTEGER,
IN sBLD_GSTSupplyCode		VARCHAR(8),
IN sBLD_GSTTaxRates	FLOAT,
IN sBLD_GSTAmt		NUMERIC(15,3),
IN sBLD_GrossTotal	NUMERIC(15,3),
IN sBLD_CRTBDIDX	INTEGER,
IN sBy              varchar(10),
IN sRecStatus       varchar(4),

IN sBLS_PatientMRN 		varchar(45),
IN sBLS_PatientName 	varchar(100),
IN sBLS_PatientIC 		varchar(30),
IN sBLS_PatientGender 	varchar(10),
IN sBLS_PatientDOB 		varchar(30),
IN sBLS_PatEthnicGrp 	varchar(45),
IN sBLS_PatOccupation 	varchar(50),
IN sBLS_PatLanguage 	varchar(50),
IN sBLS_CustomerType 	varchar(45),

OUT Result 			varchar(30),
OUT Message 		varchar(30)
)
BEGIN

SET sBLS_VisitDate  = STR_TO_DATE(REPLACE(sBLS_VisitDate,"'",''), '%Y-%m-%d %H:%i:%s');
SET sBLD_ShiftCloseDate  = STR_TO_DATE(REPLACE(sBLD_ShiftCloseDate,"'",''), '%Y-%m-%d %H:%i:%s');
SET sBLD_DispenseDate  = STR_TO_DATE(REPLACE(sBLD_DispenseDate,"'",''), '%Y-%m-%d %H:%i:%s');
SET sBLS_PatientDOB = REPLACE(sBLS_PatientDOB, "'", '');

IF sMethod = 'ADD_BILLHEADER' THEN

  IF (SELECT COUNT(bls_idx) FROM his_billsummary WHERE bls_idx = sBLS_IDX AND bls_company = sBLS_Company AND bls_branch = sBLS_Branch) = 0 THEN  
	INSERT INTO his_billsummary
    (bls_idx, bls_billno, bls_entryno, bls_visitdate, bls_qno, bls_qidx, bls_shiftcode, 
    bls_billentryno, bls_iscorporate, bls_cshcnfee, bls_cshmedfee, bls_cshinvfee, bls_cshtrmfee, 
    bls_cshexmfee, bls_cshsurfee, bls_cshothfee, bls_cshtotal, bls_partialcash, bls_invcnfee, 
    bls_invmedfee, bls_invinvfee, bls_invtrmfee, bls_invexmfee, bls_invsurfee, bls_invothfee, 
    bls_invtotal, bls_taxamt, bls_healthplancode, bls_corpaytype, bls_corporatepay, bls_hppatientpay, 
    bls_hppatientpaypercent, bls_hpcorpay, bls_hpcorpaypercent, bls_invoiced, bls_invoiceno, 
    bls_invheaderidx, bls_medicalexceed, bls_prntime, bls_doctorid, bls_billpanelcd, bls_billpanelnm, 
    bls_billchitno, bls_mcidx, bls_invseqno, bls_paidamt, bls_remark, bls_freechar1, bls_invcode, 
    bls_cshcnfeedesc, bls_invcnfeedesc, bls_discountamtcash, bls_discountamtcorp, bls_cshpkgfee, 
    bls_invpkgfee, bls_roundamt, bls_cshtax, bls_credit, bls_confirm, bls_debit, bls_type, bls_refid, 
    bls_dbtpaid, bls_discountperc, bls_discountinv, bls_discountinvperc, bls_iscategorytrsf, bls_refund, 
    bls_creditinv, bls_debitinv, bls_deposit, bls_otcremark, bls_cshprodfee, bls_invprodfee, 
    bls_controluserid, bls_saledept, bls_billstatus, bls_company, bls_branch, bls_telemarketer, 
    bls_voucher, bls_doctor, bls_salesperson, bls_salespersonvalue, bls_blood, bls_roundamtinv, 
    bls_paidamtinv, bls_jnaccgen, bls_jnaccposted, bls_recordno, bls_cshgstamt, bls_invgstamt, 
    bls_cshgrosstotal, bls_invgrosstotal, bls_gstinclusive, createby, createdate, modifyby, modifydate,
    bls_patientmrn, bls_patientname, bls_patientic, bls_patientgender, bls_patientdob, bls_patethnicgrp, 
    bls_patoccupation, bls_patlanguage, bls_customertype)
    VALUES
    (sBLS_IDX, sBLS_BillNo, sBLS_EntryNo, sBLS_VisitDate, sBLS_QNo, sBLS_QIDX, sBLS_ShiftCode, 
    sBLS_BillEntryNo, sBLS_IsCorporate, sBLS_CSHCNFEE, sBLS_CSHMEDFEE, sBLS_CSHINVFEE, sBLS_CSHTRMFEE, 
    sBLS_CSHEXMFEE, sBLS_CSHSURFEE, sBLS_CSHOTHFEE, sBLS_CSHTOTAL, sBLS_PartialCash, sBLS_INVCNFEE, 
    sBLS_INVMEDFEE, sBLS_INVINVFEE, sBLS_INVTRMFEE, sBLS_INVEXMFEE, sBLS_INVSURFEE, sBLS_INVOTHFEE, 
    sBLS_INVTOTAL, sBLS_TaxAmt, sBLS_HealthPlanCode, sBLS_CorPayType, sBLS_CorporatePay, sBLS_HPPatientPay, 
    sBLS_HPPatientPayPercent, sBLS_HPCorPay, sBLS_HPCorPayPercent, sBLS_Invoiced, sBLS_InvoiceNo, 
    sBLS_InvHeaderIDX, sBLS_MedicalExceed, sBLS_PRNTime, sBLS_DoctorID, sBLS_BillPanelCD, sBLS_BillPanelNM, 
    sBLS_BillChitNo, sBLS_MCIdx, sBLS_InvSeqNo, sBLS_PaidAmt, sBLS_Remark, sBLS_FreeChar1, sBLS_InvCode, 
    sBLS_CSHCNFEEDESC, sBLS_INVCNFEEDESC, sBLS_DiscountAmtCash, ifnull(nullif(sBLS_DiscountAmtCorp, ''), '0'), sBLS_CSHPKGFEE, 
    sBLS_INVPKGFEE, sBLS_RoundAmt, sBLS_CSHTAX, sBLS_Credit, sBLS_Confirm, sBLS_Debit, sBLS_Type, sBLS_RefID, 
    sBLS_DBTPaid, sBLS_DiscountPerc, sBLS_DiscountInv, sBLS_DiscountInvPerc, sBLS_IsCategoryTRSF, sBLS_Refund, 
    sBLS_CreditInv, sBLS_DebitInv, sBLS_Deposit, sBLS_OTCRemark, sBLS_CSHPRODFEE, sBLS_INVPRODFEE, 
    sBLS_ControlUserID, sBLS_SaleDept, sBLS_BillStatus, sBLS_Company, sBLS_Branch, sBLS_Telemarketer, 
    sBLS_Voucher, sBLS_Doctor, sBLS_SalesPerson, sBLS_SalesPersonValue, sBLS_Blood, sBLS_RoundAmtInv, 
    sBLS_PaidAmtInv, sBLS_JNAccGen, sBLS_JNAccPosted, sBLS_RecordNo, sBLS_CSHGSTAMT, sBLS_INVGSTAMT, 
    sBLS_CSHGROSSTOTAL, sBLS_INVGROSSTOTAL, sBLS_GSTInclusive, sBy, now(), sBy, now(),
    sBLS_PatientMRN, sBLS_PatientName, sBLS_PatientIC, sBLS_PatientGender, LEFT(sBLS_PatientDOB, 10), sBLS_PatEthnicGrp, 
    sBLS_PatOccupation, sBLS_PatLanguage, sBLS_CustomerType);
  else	
    UPDATE his_billsummary SET
    bls_billno = sBLS_BillNo, bls_entryno = sBLS_EntryNo, bls_visitdate = sBLS_VisitDate, bls_qno = sBLS_QNo, 
    bls_qidx = sBLS_QIDX, bls_shiftcode = sBLS_ShiftCode, bls_billentryno = sBLS_BillEntryNo, 
    bls_iscorporate = sBLS_IsCorporate, bls_cshcnfee = sBLS_CSHCNFEE, bls_cshmedfee = sBLS_CSHMEDFEE, 
    bls_cshinvfee = sBLS_CSHINVFEE, bls_cshtrmfee = sBLS_CSHTRMFEE, bls_cshexmfee = sBLS_CSHEXMFEE, 
    bls_cshsurfee = sBLS_CSHSURFEE, bls_cshothfee = sBLS_CSHOTHFEE, bls_cshtotal = sBLS_CSHTOTAL, 
    bls_partialcash = sBLS_PartialCash, bls_invcnfee = sBLS_INVCNFEE, bls_invmedfee = sBLS_INVMEDFEE, 
    bls_invinvfee = sBLS_INVINVFEE, bls_invtrmfee = sBLS_INVTRMFEE, bls_invexmfee = sBLS_INVEXMFEE, 
    bls_invsurfee = sBLS_INVSURFEE, bls_invothfee = sBLS_INVOTHFEE, bls_invtotal = sBLS_INVTOTAL, 
    bls_taxamt = sBLS_TaxAmt, bls_healthplancode = sBLS_HealthPlanCode, bls_corpaytype = sBLS_CorPayType, 
    bls_corporatepay = sBLS_CorporatePay, bls_hppatientpay = sBLS_HPPatientPay, bls_hppatientpaypercent = sBLS_HPPatientPayPercent, 
    bls_hpcorpay = sBLS_HPCorPay, bls_hpcorpaypercent = sBLS_HPCorPayPercent, bls_invoiced = sBLS_Invoiced, 
    bls_invoiceno = sBLS_InvoiceNo, bls_invheaderidx = sBLS_InvHeaderIDX, bls_medicalexceed = sBLS_MedicalExceed, 
    bls_prntime = sBLS_PRNTime, bls_doctorid = sBLS_DoctorID, bls_billpanelcd = sBLS_BillPanelCD, bls_billpanelnm = sBLS_BillPanelNM, 
    bls_billchitno = sBLS_BillChitNo, bls_mcidx = sBLS_MCIdx, bls_invseqno = sBLS_InvSeqNo, bls_paidamt = sBLS_PaidAmt, 
    bls_remark = sBLS_Remark, bls_freechar1 = sBLS_FreeChar1, bls_invcode = sBLS_InvCode, bls_cshcnfeedesc = sBLS_CSHCNFEEDESC, 
    bls_invcnfeedesc = sBLS_INVCNFEEDESC, bls_discountamtcash = sBLS_DiscountAmtCash, bls_discountamtcorp = ifnull(nullif(sBLS_DiscountAmtCorp, ''), '0'), 
    bls_cshpkgfee = sBLS_CSHPKGFEE, bls_invpkgfee = sBLS_INVPKGFEE, bls_roundamt = sBLS_RoundAmt, bls_cshtax = sBLS_CSHTAX, 
    bls_credit = sBLS_Credit, bls_confirm = sBLS_Confirm, bls_debit = sBLS_Debit, bls_type = sBLS_Type, bls_refid = sBLS_RefID, 
    bls_dbtpaid = sBLS_DBTPaid, bls_discountperc = sBLS_DiscountPerc, bls_discountinv = sBLS_DiscountInv, 
    bls_discountinvperc = sBLS_DiscountInvPerc, bls_iscategorytrsf = sBLS_IsCategoryTRSF, bls_refund = sBLS_Refund, 
    bls_creditinv = sBLS_CreditInv, bls_debitinv = sBLS_DebitInv, bls_deposit = sBLS_Deposit, bls_otcremark = sBLS_OTCRemark, 
    bls_cshprodfee = sBLS_CSHPRODFEE, bls_invprodfee = sBLS_INVPRODFEE, bls_controluserid = sBLS_ControlUserID, 
    bls_saledept = sBLS_SaleDept, bls_billstatus = sBLS_BillStatus, bls_company = sBLS_Company, bls_branch = sBLS_Branch, 
    bls_telemarketer = sBLS_Telemarketer, bls_voucher = sBLS_Voucher, bls_doctor = sBLS_Doctor, bls_salesperson = sBLS_SalesPerson, 
    bls_salespersonvalue = sBLS_SalesPersonValue, bls_blood = sBLS_Blood, bls_roundamtinv = sBLS_RoundAmtInv, 
    bls_paidamtinv = sBLS_PaidAmtInv, bls_jnaccgen = sBLS_JNAccGen, bls_jnaccposted = sBLS_JNAccPosted, bls_recordno = sBLS_RecordNo, 
	bls_cshgstamt = sBLS_CSHGSTAMT, bls_invgstamt = sBLS_INVGSTAMT, bls_cshgrosstotal = sBLS_CSHGROSSTOTAL, 
    bls_invgrosstotal = sBLS_INVGROSSTOTAL, bls_gstinclusive = sBLS_GSTInclusive, modifyby = sBy, modifydate = now(),
    bls_patientmrn = sBLS_PatientMRN, bls_patientname = sBLS_PatientName, bls_patientic = sBLS_PatientIC, 
    bls_patientgender = sBLS_PatientGender, bls_patientdob = LEFT(sBLS_PatientDOB, 10), bls_patethnicgrp = sBLS_PatEthnicGrp, 
    bls_patoccupation = sBLS_PatOccupation, bls_patlanguage = sBLS_PatLanguage, bls_customertype = sBLS_CustomerType
    WHERE bls_idx = sBLS_IDX AND bls_company = sBLS_Company AND bls_branch = sBLS_Branch;
  END IF;
  
    SELECT '00000' INTO Result;
	SELECT  'Success Inserted' INTO Message;
END IF;

IF sMethod = 'ADD_BILLDETAIL' THEN

  IF (SELECT Count(bld_idx) FROM his_billdetail WHERE bld_idx = sBLD_IDX AND bld_company = sBLS_Company AND bld_branch = sBLS_Branch) = 0 THEN
	INSERT INTO his_billdetail
    (bld_idx, bld_entryno, bld_visitdate, bld_qno, bld_qidx, bld_chgidx, bld_category, bld_chggrp, bld_chgdesc, 
    bld_uom, bld_factor, bld_qty, bld_unitprice, bld_totalprice, bld_audit, bld_isrestricted, bld_ispsychotropic, 
    bld_remark, bld_frequency, bld_instruction, bld_indication, bld_dosage, bld_docid, bld_docname, bld_dispenseby, 
    bld_dispensedate, bld_priintlabel, bld_isremoveitem, bld_chitnum, bld_precaution, bld_commited, bld_commitqty, 
    bld_commitfactor, bld_commitprice, bld_commituomidx, bld_uomidx, bld_bsbillno, bld_recordstat, bld_chgcode, 
    bld_paycash, bld_drugmixind, bld_commisionid, bld_commisionscheme, bld_discountamt, bld_discountperc, 
    bld_totalbfdis, bld_dept, bld_drugreturn, bld_stocktype, bld_shiftclosedate, bld_status, bld_homedrug, 
    bld_dayward, bld_type, bld_refid, bld_reportgrp, bld_reportgrpseq, bld_laborder, bld_avgcostuom, 
    bld_avgcostbaseuom, bld_stkdisloc, bld_immidx, bld_pkgidx, bld_refundbycash, bld_recordno, bld_drugind, 
    bld_chargeind, bld_initialunitprice, bld_usedtime, bld_csridx, bld_gstsupplycode, bld_gsttaxrates, 
    bld_gstamt, bld_grosstotal, bld_crtbdidx, createby, createdate, modifyby, modifydate, bld_branch, bld_company)
    VALUES
    (sBLD_IDX, sBLS_EntryNo, sBLS_VisitDate, sBLS_QNo, sBLS_QIDX, sBLD_CHGIDX, sBLD_Category, sBLD_CHGGrp, sBLD_CHGDesc, 
    sBLD_UOM, sBLD_Factor, sBLD_Qty, sBLD_UnitPrice, sBLD_TotalPrice, sBLD_Audit, sBLD_IsRestricted, sBLD_IsPsychotropic, 
    sBLD_Remark, sBLD_Frequency, sBLD_Instruction, sBLD_Indication, sBLD_Dosage, sBLD_DocID, sBLD_DocName, sBLD_DispenseBy, 
    sBLD_DispenseDate, sBLD_PriintLabel, sBLD_IsRemoveItem, sBLD_ChitNum, sBLD_Precaution, sBLD_Commited, sBLD_CommitQty, 
    sBLD_CommitFactor, sBLD_CommitPrice, sBLD_CommitUOMIdx, sBLD_UOMIdx, sBLD_BSBillNo, sBLD_RecordStat, sBLD_CHGCode, 
    sBLD_PayCash, sBLD_DrugMixInd, sBLD_CommisionID, sBLD_CommisionScheme, sBLD_DiscountAmt, sBLD_DiscountPerc, 
    sBLD_TotalBfDis, sBLD_Dept, sBLD_DrugReturn, sBLD_StockType, sBLD_ShiftCloseDate, sBLD_Status, sBLD_HomeDrug, 
    sBLD_DayWard, sBLD_Type, sBLD_RefID, sBLD_ReportGrp, ifnull(nullif(sBLD_ReportGrpSeq, ''), '0'), sBLD_Laborder, sBLD_AvgCostUOM, 
    sBLD_AvgCostBaseUOM, sBLD_StkDisLoc, sBLD_IMMIDX, sBLD_PKGIDX, sBLD_RefundByCash, sBLD_RecordNo, sBLD_DrugInd, 
    sBLD_ChargeInd, sBLD_InitialUnitPrice, sBLD_UsedTime, sBLD_CSRIDX, sBLD_GSTSupplyCode, sBLD_GSTTaxRates, 
    sBLD_GSTAmt, sBLD_GrossTotal, sBLD_CRTBDIDX, sBy, now(), sBy, now(), sBLS_Branch, sBLS_Company);
  ELSE
	UPDATE his_billdetail SET
    bld_entryno = sBLS_EntryNo, bld_visitdate = sBLS_VisitDate, bld_qno = sBLS_QNo, bld_qidx = sBLS_QIDX, 
	bld_chgidx = sBLD_CHGIDX, bld_category = sBLD_Category, bld_chggrp = sBLD_CHGGrp, bld_chgdesc = sBLD_CHGDesc, 
    bld_uom = sBLD_UOM, bld_factor = sBLD_Factor, bld_qty = sBLD_Qty, bld_unitprice = sBLD_UnitPrice, 
    bld_totalprice = sBLD_TotalPrice, bld_audit = sBLD_Audit, bld_isrestricted = sBLD_IsRestricted, 
    bld_ispsychotropic = sBLD_IsPsychotropic, bld_remark = sBLD_Remark, bld_frequency = sBLD_Frequency, 
    bld_instruction = sBLD_Instruction, bld_indication = sBLD_Indication, bld_dosage = sBLD_Dosage, bld_docid = sBLD_DocID, 
    bld_docname = sBLD_DocName, bld_dispenseby = sBLD_DispenseBy, bld_dispensedate = sBLD_DispenseDate, 
    bld_priintlabel = sBLD_PriintLabel, bld_isremoveitem = sBLD_IsRemoveItem, bld_chitnum = sBLD_ChitNum, 
    bld_precaution = sBLD_Precaution, bld_commited = sBLD_Commited, bld_commitqty = sBLD_CommitQty, 
    bld_commitfactor = sBLD_CommitFactor, bld_commitprice = sBLD_CommitPrice, bld_commituomidx = sBLD_CommitUOMIdx, 
    bld_uomidx = sBLD_UOMIdx, bld_bsbillno = sBLD_BSBillNo, bld_recordstat = sBLD_RecordStat, bld_chgcode = sBLD_CHGCode, 
    bld_paycash = sBLD_PayCash, bld_drugmixind = sBLD_DrugMixInd, bld_commisionid = sBLD_CommisionID, 
    bld_commisionscheme = sBLD_CommisionScheme, bld_discountamt = sBLD_DiscountAmt, bld_discountperc = sBLD_DiscountPerc, 
    bld_totalbfdis = sBLD_TotalBfDis, bld_dept = sBLD_Dept, bld_drugreturn = sBLD_DrugReturn, bld_stocktype = sBLD_StockType, 
    bld_shiftclosedate = sBLD_ShiftCloseDate, bld_status = sBLD_Status, bld_homedrug = sBLD_HomeDrug, bld_dayward = sBLD_DayWard, 
    bld_type = sBLD_Type, bld_refid = sBLD_RefID, bld_reportgrp = sBLD_ReportGrp, bld_reportgrpseq = ifnull(nullif(sBLD_ReportGrpSeq, ''), '0'), 
    bld_laborder = sBLD_Laborder, bld_avgcostuom = sBLD_AvgCostUOM, bld_avgcostbaseuom = sBLD_AvgCostBaseUOM, 
    bld_stkdisloc = sBLD_StkDisLoc, bld_immidx = sBLD_IMMIDX, bld_pkgidx = sBLD_PKGIDX, bld_refundbycash = sBLD_RefundByCash, 
    bld_recordno = sBLD_RecordNo, bld_drugind = sBLD_DrugInd, bld_chargeind = sBLD_ChargeInd, bld_initialunitprice = sBLD_InitialUnitPrice, 
    bld_usedtime = sBLD_UsedTime, bld_csridx = sBLD_CSRIDX, bld_gstsupplycode = sBLD_GSTSupplyCode, bld_gsttaxrates = sBLD_GSTTaxRates, 
    bld_gstamt = sBLD_GSTAmt, bld_grosstotal = sBLD_GrossTotal, bld_crtbdidx = sBLD_CRTBDIDX, modifyby = sBy, modifydate = now(),
    bld_company = sBLS_Company, bld_branch = sBLS_Branch
    WHERE bld_idx = sBLD_IDX AND bld_company = sBLS_Company AND bld_branch = sBLS_Branch;
  END IF;
  
	SELECT '00000' INTO Result;
	SELECT  'Success Inserted' INTO Message;
END IF;

END