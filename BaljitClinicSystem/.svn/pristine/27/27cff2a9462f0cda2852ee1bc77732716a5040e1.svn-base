<!--
   by amira, date 11/4/2016
 -->
<%@taglib prefix="jstl" uri="http://java.sun.com/jsp/jstl/core" %>
<jsp:useBean id="DDL" scope="page" class="BusinessLogic.Servlet_PopulateData" />
<style type="text/css">
    .ui-jqgrid tr.jqgrow td {
        word-wrap: break-word; /* IE 5.5+ CSS3 see http://www.w3.org/TR/css3-text/#text-wrap */
        white-space: pre-wrap; /* CSS3 */
        white-space: -moz-pre-wrap; /* Mozilla, since 1999 */
        white-space: -pre-wrap; /* Opera 4-6 */
        white-space: -o-pre-wrap; /* Opera 7 */
        overflow: hidden;
        height: auto;
        vertical-align: middle;
        padding-top: 3px;
        padding-bottom: 3px
    }    
    div.errorContainer, div.errorContainer2{
        display:none;
        width:100%;
    }
    div.errorContainer, div.errorContainer2 ol li{
        list-style-type:disc;
        margin-left: 20px;
    }
    li{
        list-style:none;
    }
    input[type="text"].error { border: 1px solid #A94444; background-color:#FFF0F0; }
    select.error { border: 1px solid #A94444; background-color:#FFF0F0; }
    textarea.error { border: 1px solid #A94444; background-color:#FFF0F0; }
</style>

<link rel="stylesheet" type="text/css" href="css/your_style.css" />
<link rel="stylesheet" type="text/css" href="js/plugin/jqgrid/ui.multiselect.css" />

<section id="widget-grid" class="">
    <!--<input type="text" id="lblUserCode" value="<%= session.getAttribute("s_usercode")%>"  class="tboxreadonlyShort"/>-->
    <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
        <h1 class="page-title txt-color-blueDark">
            <!-- PAGE HEADER -->
            <i class="fa-fw fa fa-file fa-2x"></i> 
            Stock Supplier Setup                                  
        </h1>
    </div>
    <div class="row">
        <form id="form_StockInfo" name="form_StockInfo">
        <article class="col-sm-12 col-md-12 col-lg-12">  
            <div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-2"  data-widget-editbutton="false" data-widget-colorbutton="false" data-widget-fullscreenbutton="false" data-widget-custombutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false">
                <header>
                    <span class="widget-icon"> <i class="fa fa-file"></i></span>
                    <span><h2>&nbsp;Stock Info</h2></span>
                </header>
                <div class="no-padding">
                    <div class="widget-body">
                        <div id="selectCriTab" class="tab-content">
                            <div class="padding-10">
                                <table id="tblStockInfo" class="selection-criteria">
                                    <tr>
                                        <td width="15%">Stock Code:</td>
                                        <td width="100%">                                            
                                            <input type="text" id="txtStockCode" name="txtStockCode" readonly class="tboxreadonly" style="width: 350px;"/>
                                        </td>
                                    </tr> 
                                    <tr>
                                        <td width="15%">Default UOM:</td>
                                        <td width="100%">                                            
                                            <input type="text" id="txtDefaultUOM" name="txtDefaultUOM" readonly class="tboxreadonly" style="width: 350px;"/>
                                        </td>  
                                    </tr>                                     
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </article> 
        <div hidden>
            <input type="hidden" id="hidStkSupplier" name="hidStkSupplier"/>                                               
        </div>    
        </form>                             
    </div>
    
    <!-- stock supplier table -->
    <div class="row">
        <article class="col-sm-12 col-md-12 col-lg-12">
            <div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-3"  data-widget-editbutton="false" data-widget-custombutton="false" data-widget-deletebutton="false" data-widget-colorbutton="false" data-widget-fullscreenbutton="false" data-widget-togglebutton="false">
                <header>
                    <span class="widget-icon"> <i class="fa fa-file"></i></span>
                    <span><h2>&nbsp;Stock Supplier Info</h2></span>
                </header>
                <div class="padding-10">
                    
                    <div class="table-responsive" id="dvStkSupplier">
                        <div id="cjqgridStkSupplier"></div>
                        <table id="jqgridStkSupplier" class="table table-striped table-bordered"  ></table>
                        <div id="pjqgridStkSupplier"></div>
                    </div>
                    
                    <table id="tbStkSupplier" class="selection-criteria table-striped" style="display: none;" >                                    
                        <tr>
                            <th>Supplier</th>
                            <td>
                                <div class="dropdown">
                                    <label id="selectSupplier" class="searchbox">
                                        <select class="form-control" id="ddlSupplier" name="ddlSupplier" rel="popover-hover" data-original-title="Supplier" data-content="Select Supplier." style="width:200px;">
                                            <option value="">- Select Supplier -</option>
                                            <jstl:forEach var="ddl_Supplier" items="${DDL.ddlGet('GET_SUPPLIER', '', '')}">
                                                <option value="${ddl_Supplier.VALUE}">${ddl_Supplier.VALUE}</option>
                                            </jstl:forEach>  
                                        </select>    
                                    </label>   
                                </div>
                            </td>
                            <th>UOM</th>
                            <td>
                                <div class="dropdown">
                                    <label id="selectUOM" class="searchbox">
                                        <select class="form-control" id="ddlUOM" name="ddlUOM" rel="popover-hover" data-original-title="UOM" data-content="Select UOM." style="width:200px;">
                                            <option value="">- Select UOM -</option>
                                        </select>    
                                    </label>   
                                </div>
                            </td>
                            <th>Unit Cost</th>
                            <td>
                                <input type="text" class="form-control numeric" id="txtUnitCost" name="txtUnitCost" maxlength="100" placeholder="Unit Cost" style="width:200px;"/>
                            </td>
                            <th>Company</th>
                            <td>
                                <div class="dropdown">
                                    <label id="selectCompany" class="searchbox">
                                        <select class="form-control" id="ddlCompany" name="ddlCompany" rel="popover-hover" data-original-title="Company" data-content="Select Company." style="width:200px;">
                                            <option value="">- Select Company -</option>
                                            <jstl:forEach var="ddl_Company" items="${DDL.ddlGet('GET_COMP', '', '')}">
                                                <option value="${ddl_Company.VALUE}">${ddl_Company.VALUE}</option>
                                            </jstl:forEach>  
                                        </select>    
                                    </label>   
                                </div>
                            </td>
                            <td align="center">
                                <button onclick="add_StkSupplier();" style="border:none;background:transparent;"><i class='fa fa-plus-square fa-2x'></i></button>
                            </td>                                
                        </tr>
                    </table>

                    <div id="gridStkSupplierSummary" class="" style=" display: none;">
                        <table  class="table table-striped" id="myTable" >
                            <thead>
                            <th>Action</th>
                            <th id="SUPPLIER">Supplier</th>
                            <th id="UOM">UOM</th>
                            <th id="UNITCOST">Unit Cost</th> 
                            <th id="COMPANY">Company</th>                                                            
                            </thead>
                            <tbody id="StkSupplierSummaryGrid" >

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div align="center" class="padding-5" >
                <input type="button" id="btnEdit" class="btn btn-default bg-color-blueDark txt-color-white form-btn" name="btnEdit" value="Edit Detail" onclick="enableEdit()" style="margin-right:20px;"/>
                <input type="button" id="btnSave"  class="btn btn-default bg-color-blueDark txt-color-white" value="Update Product" style="display: none;" />
                <input type="button" id="btnCancel"  class="btn btn-default bg-color-blueDark txt-color-white"  value="Go Back" />        
            </div>
        </article>       
    </div>
    <!-- end of stock supplier table -->
</section>
 <jsp:include page="../../includes/loading-no-status.jsp"/>  
<script src="js/buttonset.js"></script>
<script type="text/javascript">
    
    pageSetUp();
    
    $("#btnCancel").click(function(){
        var btnCancel = $('#btnCancel').val();
        
        if (btnCancel === 'Go Back'){
            location.href = '#/ProductDetail/' + $('#txtStockCode').val();
        } else if (btnCancel === 'Cancel'){
            location.reload();
        }
    });      
    
    function bindData(sParam) {
        BindStockUOM(sParam.STKCODE);   
        $('#txtStockCode').val(sParam.STKCODE);
        $('#txtDefaultUOM').val(sParam.DEFAULTUOM);       
        var pagefunction = function () {
            loadScript("js/plugin/jqgrid/ui.multiselect.js", function () {
                loadScript("js/plugin/jqgrid/grid.locale-en.min.js", function () {
                    loadScript("js/plugin/jqgrid/jquery.jqGrid.min.js", function () {
                        loadScript("js/column-chooser.js", function () {
                            run_jqgrid_function();
                        });
                    });
                });
            });
            //loadScript("js/plugin/jqgrid/jquery.jqGrid.min.js", run_jqgrid_function);
            function run_jqgrid_function() {

                var grid = $("#jqgridStkSupplier"),
                        gridPager = "#p" + grid.selector.toString().substring(1),
                        conDiv = $("#c" + grid.selector.toString().substring(1)),
                        defaultColName = ['Supplier', 'UOM', 'Unit Cost', 'Company'],
                        defaultColMol = [
                            {name: 'stsp_supcode', index: 'stsp_supcode', sortable: true, must: true, hidedlg: true},
                            {name: 'stsp_uomcode', index: 'stsp_uomcode', sortable: true, must: true, hidedlg: true},
                            {name: 'stsp_unitcost', index: 'stsp_unitcost', sortable: true, must: true, hidedlg: true},
                            {name: 'stsp_companycode', index: 'stsp_companycode', sortable: true, must: true, hidedlg: true}                           
                        ],
                        mainGridName = grid.selector.toString().substring(1),
                        //temp = readSettings({settingArray:${sessionScope.settings}, defaultColName: defaultColName, defaultColMol: defaultColMol, settingName: mainGridName});//,
                        temp = readSettings({settingArray: "admin", defaultColName: defaultColName, defaultColMol: defaultColMol, settingName: mainGridName}),
                        currentColName = temp[0],
                        currentColMol = temp[1];
                // alert(JSON.stringify(temp));
                grid.jqGrid({
                    url: '${pageContext.request.contextPath}/Servlet_Stock',
                    postData: {
                        SFC: 'GET_STOCKDETAIL_LIST',
                        STOCKCODE: $('#txtStockCode').val(), 
                        //DEFAULTUOM: $('#txtDefaultUOM').val(),
                        FUNCTION: 'STOCK_SUPPLIER'
                    },
                    loadError: function (jqXHR, textStatus, errorThrown) {
                        alert('HTTP status code: ' + jqXHR.status + '\n' +
                              'textStatus: ' + textStatus + '\n' +
                              'errorThrown: ' + errorThrown);
                        alert('HTTP message body (jqXHR.responseText): ' + '\n' + jqXHR.responseText);
                    },
                    datatype: "json",
                    mtype: 'POST',
                    colNames: currentColName,
                    colModel: currentColMol,
                    // rownumbers: true,
                    gridview: true,
                    rownumWidth: 40,
                    rowNum: 20,
                    rowList: [10, 20, 25, 30, 50, 100],
                    pager: gridPager,
                    //sortname: 'stsp_supcode',
                    viewrecords: true,
                    sortorder: 'asc',
                    toolbarfilter: true,
                    autowidth: true,
                    shrinkToFit: true,
                    loadonce: false,
                    height: 'auto',
                    scrollerbar: false,
                    sortable: {
                        update: function (relativeColumnOrder) {
                            //sortColumn({settingArray:${sessionScope.settings}, order: relativeColumnOrder, grid: grid, defaultColMol: defaultColMol, settingName: mainGridName});
                            sortColumn({settingArray: "admin", order: relativeColumnOrder, grid: grid, defaultColMol: defaultColMol, settingName: mainGridName});
                        }
                    },
                    loadComplete: function () {
                        var iLastPage = parseInt($(this).getGridParam('lastpage'));
                        $(".ui-jqgrid .ui-pg-input").keydown(function (e) {
                            this.value = this.value.replace(/\D/g, '');
                            var code = e.keyCode || e.which;
                            if (code === 13) {
                                if (this.value > iLastPage) {
                                    this.value = iLastPage;
                                } else if (this.value <= 0) {
                                    this.value = 1;
                                }
                            }
                        });
                    }
                });

                // remove classes
                $(".ui-jqgrid").removeClass("ui-widget ui-widget-content");
                $(".ui-jqgrid-view").children().removeClass("ui-widget-header ui-state-default");
                $(".ui-jqgrid-labels, .ui-search-toolbar").children().removeClass("ui-state-default ui-th-column ui-th-ltr");
                $(".ui-jqgrid-pager").removeClass("ui-state-default");
                $(".ui-jqgrid").removeClass("ui-widget-content");
                // add classes
                $(".ui-jqgrid-htable").addClass("table table-bordered table-hover");
                $(".ui-jqgrid-btable").addClass("table table-bordered table-striped");
                $(".ui-pg-div").removeClass().addClass("btn btn-sm btn-primary");
                $(".ui-icon.ui-icon-plus").removeClass().addClass("fa fa-plus");
                $(".ui-icon.ui-icon-pencil").removeClass().addClass("fa fa-pencil");
                $(".ui-icon.ui-icon-trash").removeClass().addClass("fa fa-trash-o");
                $(".ui-icon.ui-icon-search").removeClass().addClass("fa fa-search");
                $(".ui-icon.ui-icon-refresh").removeClass().addClass("fa fa-refresh");
                $(".ui-icon.ui-icon-disk").removeClass().addClass("fa fa-save").parent(".btn-primary").removeClass("btn-primary").addClass("btn-success");
                $(".ui-icon.ui-icon-cancel").removeClass().addClass("fa fa-times").parent(".btn-primary").removeClass("btn-primary").addClass("btn-danger");
                $(".ui-icon.ui-icon-seek-prev").wrap("<div class='btn btn-sm btn-default'></div>");
                $(".ui-icon.ui-icon-seek-prev").removeClass().addClass("fa fa-backward");
                $(".ui-icon.ui-icon-seek-first").wrap("<div class='btn btn-sm btn-default'></div>");
                $(".ui-icon.ui-icon-seek-first").removeClass().addClass("fa fa-fast-backward");
                $(".ui-icon.ui-icon-seek-next").wrap("<div class='btn btn-sm btn-default'></div>");
                $(".ui-icon.ui-icon-seek-next").removeClass().addClass("fa fa-forward");
                $(".ui-icon.ui-icon-seek-end").wrap("<div class='btn btn-sm btn-default'></div>");
                $(".ui-icon.ui-icon-seek-end").removeClass().addClass("fa fa-fast-forward");
                $(".ui-pg-input").addClass("pg-input");

                // resize Stock Supplier Grid
                $(window).on('resize', function () {
                    grid.jqGrid('setGridWidth', conDiv.width());
                });
                grid.on('myRefresh', function () {
                    resizeWidth({grid: grid, gridDiv: conDiv});
                });
    //         quickSetupChooser({grid: grid, defaultColMol: defaultColMol, settingName: mainGridName,
    //            settingArray:${sessionScope.settings},
                quickSetupChooser({grid: grid, defaultColMol: defaultColMol, settingName: mainGridName,
                    settingArray: "admin",
                    done: function () {
                        resizeWidth({grid: grid, gridDiv: conDiv});
                    }
                });
                grid.jqGrid('setGridWidth', conDiv.width());
            };
        };//END OF pagefunction
        loadScript("js/plugin/jqgrid/grid.locale-en.min.js", pagefunction); 
    }
    
    function BindStockUOM(stkCode) {
        $.get('${pageContext.request.contextPath}/Servlet_Stock', {SFC: 'GET_REL_STKUOM', STKCODE: stkCode}, function (data) {
            
            var myStkUOM = {};        
            myStkUOM = JSON.parse(data);
            for (var i = 0; i < myStkUOM.rows.length; i++) {
                $("#ddlUOM").append('<option value=' + myStkUOM.rows[i].VALUE + '>' + myStkUOM.rows[i].TEXT + '</option>');
            }
        });           
    }
    
    function enableEdit() {                      
        
        $.showLoadingNoStatus();
        $('#btnCancel').val('Cancel');
        document.getElementById('btnSave').style.display = '';
        document.getElementById('btnEdit').style.display = 'none';  
 
        document.getElementById('tbStkSupplier').style.display = '';
        document.getElementById('gridStkSupplierSummary').style.display = '';
        document.getElementById('dvStkSupplier').style.display = 'none';                                                            

        var allRowsInGrid = jQuery("#jqgridStkSupplier").jqGrid('getRowData');
   
        for (var i = 0; i < allRowsInGrid.length; i++)
        {
            var $table = $(this).closest('table'),
                SupplierCode = allRowsInGrid[i].stsp_supcode,
                UOMCode = allRowsInGrid[i].stsp_uomcode,               
                UnitCost = allRowsInGrid[i].stsp_unitcost,
                CompCode = allRowsInGrid[i].stsp_companycode;
            
            $("#myTable tbody").append("<tr>" +
                "<td width='15%'>" +
                "<button type='button' class='editSummaryGrid' onclick='summaryEdit(this);'><span class='glyphicon glyphicon-pencil'></span>Edit</button>&nbsp;\n\
                 <button type='button' class='editSummaryGrid' onclick='summaryDelete(this);'><span class='glyphicon glyphicon-trash'></span>Delete</button>\n\
                 <button type='button' class='DeleteSummaryGrid' onclick='UndoDelete(this);'>Undo</button>\n\
                 <button  class='btnSummaryGrid' onclick='saveSummaryChanges(this);'><span class='glyphicon glyphicon-save'></span>Save</button>&nbsp;\n\
                 <button  class='btnSummaryGrid' onclick='summaryCancel(this);'>Cancel</button>\n\
                </td>" +
                "<td width='20%' style='display:none;'><label class='lblFunction'>NO</label></td>" +
                "<td width='20%'><label class='labelSupplierCode'>" + SupplierCode + "</label><input type='text' class='modalSupplierCode' ID='editSupCode' readonly disabled='disabled' value=" + SupplierCode + "  style='display:none;width:200px;border:none;background:#FFFFFF;' /></td>" +
                "<td width='20%'><label class='labelUOMCode'>" + UOMCode + "</label><input type='text' class='modalUOMCode' ID='editUOMCode' readonly disabled='disabled' value=" + UOMCode + "  style='display:none;width:200px;border:none;background:#FFFFFF;' /></td>" +
                "<td width='20%'><label class='labelUnitCost'>" + UnitCost + "</label><input type='text' class='modalUnitCost'  value=" + UnitCost + "  style='display:none;width:200px;border:none;background:#FFFFFF;' /></td>" +
                "<td width='20%'><label class='labelCompCode'>" + CompCode + "</label><input type='text' class='modalCompCode' ID='editCompCode' readonly disabled='disabled' value=" + CompCode + "  style='display:none;width:200px;border:none;background:#FFFFFF;' /></td>"
            + "</tr>");

            $(".editSummaryGrid").show();
            $(".DeleteSummaryGrid").hide();
            $(".btnSummaryGrid").hide();
            $('#ddlSupplier').val('');
            $('#ddlUOM').val('');
            $('#txtUnitCost').val(''); 
            $('#ddlCompany').val('');
        }    
        $.hideLoadingNoStatus();
    }
    
    function add_StkSupplier() {
        //append data of added row into table
        
        if ($('#ddlSupplier').val() === "") {
            alert('Please select Supplier.');
            return false;
        } 
        if ($('#ddlUOM').val() === "") {
            alert('Please select UOM.');
            return false;
        } 
        if ($('#txtUnitCost').val() === "") {
            alert('Please enter Unit Cost.');
            return false;
        }
        if ($('#ddlCompany').val() === "") {
            alert('Please select Company.');
            return false;
        }
        var $table = $(this).closest('table'),
            SupplierCode = $('#ddlSupplier').val(),
            UOMCode = $('#ddlUOM').val(),
            UnitCost = $('#txtUnitCost').val(),
            CompCode = $('#ddlCompany').val();

        $("#myTable tbody").append("<tr>" +
                "<td>" +
                "<button type='button' class='editSummaryGrid' onclick='summaryEdit(this);'><span class='glyphicon glyphicon-pencil'></span>Edit</button>&nbsp;\n\
                 <button type='button' class='editSummaryGrid' onclick='summaryDelete(this);'><span class='glyphicon glyphicon-trash'></span>Delete</button>\n\
                 <button style='display:none;' type='button' class='DeleteSummaryGrid' onclick='UndoDelete(this);'>Undo</button>\n\
                 <button style='display:none;' class='btnSummaryGrid' onclick='saveSummaryChanges(this);'><span class='glyphicon glyphicon-save'></span>Save</button>&nbsp;\n\
                 <button style='display:none;' class='btnSummaryGrid' onclick='summaryCancel(this);'>Cancel</button>\n\
                </td>" +
                "<td width='20%' style='display:none;'><label class='lblFunction'>INSERT</label></td>" +
                "<td width='20%'><label class='labelSupplierCode'>" + SupplierCode + "</label><input type='text' class='modalSupplierCode' disabled='disabled' value=" + SupplierCode + "  style='display:none;width:200px;border:none;background:#FFFFFF;' /></td>" +
                "<td width='20%'><label class='labelUOMCode'>" + UOMCode + "</label><input type='text' class='modalUOMCode' disabled='disabled' value=" + UOMCode + "  style='display:none;width:200px;border:none;background:#FFFFFF;' /></td>" +
                "<td width='20%'><label class='labelUnitCost'>" + UnitCost + "</label><input type='text' class='modalUnitCost'  value=" + UnitCost + "  style='display:none;width:200px;border:none;background:#FFFFFF;' /></td>" +
                "<td width='20%'><label class='labelCompCode'>" + CompCode + "</label><input type='text' class='modalCompCode' disabled='disabled' value=" + CompCode + "  style='display:none;width:200px;border:none;background:#FFFFFF;' /></td>"
            + "</tr>");
        
        $('#ddlSupplier').val('');
        $('#ddlUOM').val('');
        $('#txtUnitCost').val('');
        $('#ddlCompany').val('');       
    }  
    
    function summaryDelete(e) {

        //$(e).closest('tr').remove();       
        var closestTR = $(e).closest('tr');

        closestTR.find('label.lblFunction').html('DELETE');

        closestTR.find('td').prop('disabled', false);
        closestTR.find('td').css('background', '#800000');

        closestTR.find('button.DeleteSummaryGrid').show();
        closestTR.find('button.editSummaryGrid').hide();
        closestTR.find('button.btnSummaryGrid').hide();
    }
    
    function UndoDelete(e) {
        var closestTR = $(e).closest('tr'),
            modalSupplierCode = closestTR.find('input.modalSupplierCode').val(),
            modalUOMCode = closestTR.find('input.modalUOMCode').val(),
            modalUnitCost = closestTR.find('input.modalUnitCost').val(),
            modalCompCode = closestTR.find('input.modalCompCode').val();

        closestTR.find('label.labelSupplierCode').html(modalSupplierCode);
        closestTR.find('label.labelUOMCode').html(modalUOMCode);
        closestTR.find('label.labelUnitCost').html(modalUnitCost);
        closestTR.find('label.labelCompCode').html(modalCompCode);               
        closestTR.find('label.lblFunction').html('NO');

        closestTR.find('td').prop('disabled', false);
        // $closestTR.find('input').css('class', 'form-control searchbox-text');
        closestTR.find('td').css('background', 'transparent');

        closestTR.find('button.DeleteSummaryGrid').hide();
        closestTR.find('button.editSummaryGrid').show();
        closestTR.find('button.btnSummaryGrid').hide();

        $(e).closest('tr').find('td').each(function () {
            // $(this).find('label').css('background', 'transparent');
            //$(this).find('input').hide();
        });
    }
    
    function summaryEdit(e) {

        var $this = $(e),
            $td = $this.closest('td'),
            $tr = $this.closest('tr');
        $tr.find('td').each(function () {
            $(this).find('label').hide();
            $(this).find('input').show();
        });
        var btnSummaryGrid = $td.find('button.btnSummaryGrid'),
                editSummaryGrid = $td.find('button.editSummaryGrid'),
                $closestTR = $this.closest('tr');
        // modalFactor = $closestTR.find('input.modalFactor').val();

        $closestTR.find('input').prop('disabled', false);
        // $closestTR.find('input').css('class', 'form-control searchbox-text');
        $closestTR.find('input').css('border', '1px solid #ccc');
        //class="form-control searchbox-text"

        $closestTR.find('input#editSupCode').prop('disabled', false);
        $closestTR.find('input#editSupCode').css('border', '1px solid #fff');
        
        $closestTR.find('input#editUOMCode').prop('disabled', false);
        $closestTR.find('input#editUOMCode').css('border', '1px solid #fff');
        
        $closestTR.find('input#editCompCode').prop('disabled', false);
        $closestTR.find('input#editCompCode').css('border', '1px solid #fff');

        // $closestTR.find('input.modalUOM').css('display', 'block');
        $closestTR.find('button.editSummaryGrid').hide();
        $closestTR.find('button.btnSummaryGrid').show();
    }

    function summaryCancel(e) {
        $(e).closest('tr').find('button.editSummaryGrid').show();
        $(e).closest('tr').find('button.btnSummaryGrid').hide();
         
        $(e).closest('tr').find('input').prop('disabled', true);
        $(e).closest('tr').find('input').css('border', 'none');
        $(e).closest('tr').find('td').each(function () {
            $(this).find('label').show();
            $(this).find('input').hide();
        });
    }

    function saveSummaryChanges(e) {
        
        var closestTR = $(e).closest('tr'),
            modalSupplierCode = closestTR.find('input.modalSupplierCode').val(),
            modalUOMCode = closestTR.find('input.modalUOMCode').val(),
            modalUnitCost = closestTR.find('input.modalUnitCost').val(),
            modalCompCode = closestTR.find('input.modalCompCode').val();
 
        closestTR.find('label.labelSupplierCode').html(modalSupplierCode);
        closestTR.find('label.labelUOMCode').html(modalUOMCode);
        closestTR.find('label.labelUnitCost').html(modalUnitCost);       
        closestTR.find('label.labelCompCode').html(modalCompCode);
        closestTR.find('label.lblFunction').html('UPDATE');

        closestTR.find('button.editSummaryGrid').show();
        closestTR.find('button.btnSummaryGrid').hide();
        closestTR.find('button.DeleteSummaryGrid').hide();
    
        $(e).closest('tr').find('input').prop('disabled', true);
        $(e).closest('tr').find('input').css('border', 'none');
        $(e).closest('tr').find('td').each(function () {
            $(this).find('label').show();
            $(this).find('input').hide();
        });
    }          
    
    $("#btnSave").click(function () {
       
        var StkSupplierData = new Array();
        $('#myTable tr').each(function (row, th) {
            StkSupplierData[row] = {
                "FUNCTION": $(th).find('td:eq(1)').text(),
                "SUPPLIER": $(th).find('td:eq(2)').text(),
                "UOM": $(th).find('td:eq(3)').text(),
                "UNITCOST": $(th).find('td:eq(4)').text(),
                "COMPANY": $(th).find('td:eq(5)').text(),               
                "STOCKCODE": $('#txtStockCode').val()             
            };
        });

        StkSupplierData.splice(0, 1);

        var ItemToSend = JSON.stringify(StkSupplierData);
        $('#hidStkSupplier').load().val(ItemToSend).valid();
        //alert($('#hidStkSupplier').val());

        var request = $.ajax({
            type: "POST",
            url: "${pageContext.request.contextPath}/Servlet_Stock?SFC=UPDATE_STOCK_SUPPLIER",
            data: {
                STOCKSUPPLIER: $('#hidStkSupplier').val()
            },
            dataType: 'json'
        });
        request.done(function (response) {
            if (response.bool === true) {
                $.bigBoxSuccess({
                    title: "Stock Supplier Updated Successfully.",
                    content: "Stock Supplier Updated Successfully.",
                    timeout: 6000
                });              
            } else {
                if (response.msg === 'DUPLICATE_ENTRY'){
                    $.bigBoxFail({
                        title: "Create Stock Supplier FAIL.",
                        content: "Error : Record already exist.<br> Please try again...",
                        timeout: 6000
                    });
                } else {
                    $.bigBoxFail({
                        title: "Stock Supplier FAILED To Update.",
                        content: "There is some error during data update.<br> Please try again...",
                        timeout: 6000
                    });
                }                               
            }
            setTimeout(function(){
               location.reload();
            }, 3000);  
        });     
    });  
</script>