<!--
   by amira, date 12/2/2016
 -->
<%@taglib prefix="jstl" uri="http://java.sun.com/jsp/jstl/core" %>
<jsp:useBean id="DDL" scope="page" class="BusinessLogic.Servlet_PopulateData" />
<style type="text/css">
    .ui-jqgrid tr.jqgrow td {
        word-wrap: break-word; /* IE 5.5+ CSS3 see http://www.w3.org/TR/css3-text/#text-wrap */
        white-space: pre-wrap; /* CSS3 */
        white-space: -moz-pre-wrap; /* Mozilla, since 1999 */
        white-space: -pre-wrap; /* Opera 4-6 */
        white-space: -o-pre-wrap; /* Opera 7 */
        overflow: hidden;
        height: auto;
        vertical-align: middle;
        padding-top: 3px;
        padding-bottom: 3px
    }    
    div.errorContainer, div.errorContainer2{
        display:none;
        width:100%;
    }
    div.errorContainer, div.errorContainer2 ol li{
        list-style-type:disc;
        margin-left: 20px;
    }
    li{
        list-style:none;
    }
    input[type="text"].error { border: 1px solid #A94444; background-color:#FFF0F0; }
    select.error { border: 1px solid #A94444; background-color:#FFF0F0; }
    textarea.error { border: 1px solid #A94444; background-color:#FFF0F0; }
</style>

<link rel="stylesheet" type="text/css" href="css/your_style.css" />
<link rel="stylesheet" type="text/css" href="js/plugin/jqgrid/ui.multiselect.css" />

<section id="widget-grid" class="">
    <!--<input type="text" id="lblUserCode" value="<%= session.getAttribute("s_usercode")%>"  class="tboxreadonlyShort"/>-->
    <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
        <h1 class="page-title txt-color-blueDark">
            <!-- PAGE HEADER -->
            <i class="fa-fw fa fa-file fa-2x"></i> 
            Stock Reorder Setup                                  
        </h1>
    </div>
    <div class="row">
        <form id="form_StockInfo" name="form_StockInfo">
        <article class="col-sm-12 col-md-12 col-lg-12">  
            <div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-2"  data-widget-editbutton="false" data-widget-colorbutton="false" data-widget-fullscreenbutton="false" data-widget-custombutton="false" data-widget-deletebutton="false" data-widget-togglebutton="false">
                <header>
                    <span class="widget-icon"> <i class="fa fa-file"></i></span>
                    <span><h2>&nbsp;Stock Info</h2></span>
                </header>
                <div class="no-padding">
                    <div class="widget-body">
                        <div id="selectCriTab" class="tab-content">
                            <div class="padding-10">
                                <table id="tblStockInfo" class="selection-criteria">
                                    <tr>
                                        <td width="15%">Stock Code:</td>
                                        <td width="100%">                                            
                                            <input type="text" id="txtStockCode" name="txtStockCode" readonly class="tboxreadonly" style="width: 350px;"/>
                                        </td>
                                    </tr> 
                                    <tr>
                                        <td width="15%">Default UOM:</td>
                                        <td width="100%">                                            
                                            <input type="text" id="txtDefaultUOM" name="txtDefaultUOM" readonly class="tboxreadonly" style="width: 350px;"/>
                                        </td>  
                                    </tr>                                     
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </article> 
        <div hidden>
            <input type="hidden" id="hidStkReorder" name="hidStkReorder"/>                                               
        </div>    
        </form>                             
    </div>
    
    <!-- stock reorder table -->
    <div class="row">
        <article class="col-sm-12 col-md-12 col-lg-12">
            <div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-3"  data-widget-editbutton="false" data-widget-custombutton="false" data-widget-deletebutton="false" data-widget-colorbutton="false" data-widget-fullscreenbutton="false" data-widget-togglebutton="false">
                <header>
                    <span class="widget-icon"> <i class="fa fa-file"></i></span>
                    <span><h2>&nbsp;Stock Reorder Info</h2></span>
                </header>
                <div class="padding-10">
                    
                    <div class="table-responsive" id="dvStkReorder">
                        <div id="cjqgridStkReorder"></div>
                        <table id="jqgridStkReorder" class="table table-striped table-bordered"  ></table>
                        <div id="pjqgridStkReorder"></div>
                    </div>
                    
                    <table id="tbStkReorder" class="selection-criteria table-striped" style="display: none;" >                                    
                        <tr>
                            <th>Company</th>
                            <td>
                                <div class="dropdown">
                                    <label id="selectCompany" class="searchbox">
                                        <select class="form-control" id="ddlCompany" name="ddlCompany" rel="popover-hover" data-original-title="Company" data-content="Select Company." style="width:200px;">
                                            <option value="">- Select Company -</option>
                                            <jstl:forEach var="ddl_Company" items="${DDL.ddlGet('GET_COMP', '', '', sessionScope.SiteName)}">
                                                <option value="${ddl_Company.VALUE}">${ddl_Company.VALUE} - ${ddl_Company.TEXT}</option>
                                            </jstl:forEach> 
                                        </select>    
                                    </label>   
                                </div>
                            </td>
                            <th>Location</th>
                            <td>
                                <div class="dropdown">
                                    <label id="selectLocation" class="searchbox">
                                        <select class="form-control" id="ddlLocation" name="ddlLocation" rel="popover-hover" data-original-title="Location" data-content="Select Location." style="width:200px;">
                                            <option value="">- Select Location -</option>                                            
                                        </select>    
                                    </label>   
                                </div>
                            </td>
                            <th>Reorder Level</th>
                            <td>
                                <input type="text" class="form-control numeric" id="txtReorderLvl" name="txtReorderLvl" maxlength="100" placeholder="Reorder Level" style="width: 150px;"/>
                            </td>                  
                            <th>Reorder Quantity</th>
                            <td>
                                <input type="text" class="form-control numeric" id="txtReorderQty" name="txtReorderQty" maxlength="100" placeholder="Reorder Quantity" style="width: 150px;"/>
                            </td>
                            <td align="center">
                                <button onclick="add_StkReorder();" style="border:none;background:transparent;"><i class='fa fa-plus-square fa-2x'></i></button>
                            </td>  
                        </tr>
                    </table>

                    <div id="gridStkReorderSummary" class="" style=" display: none;">
                        <table  class="table table-striped" id="myTable" >
                            <thead>
                            <th>Action</th>
                            <th id="COMPANY">Company</th>
                            <th id="LOCATION">Location</th> 
                            <th id="REORDERLVL">Reorder Level</th>   
                            <th id="REORDERQTY">Reorder Quantity</th> 
                            </thead>
                            <tbody id="StkReorderSummaryGrid" >

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </article>       
    </div>
    <!-- end of stock reorder table -->
    
    <div class="row">
        <div class="col-sm-12">
            <div align="center" class="padding-5" >
                <input type="button" id="btnEdit" class="btn btn-default bg-color-blueDark txt-color-white form-btn" name="btnEdit" value="Edit Detail" onclick="enableEdit()" style="margin-right:20px;"/>
                <input type="button" id="btnSave"  class="btn btn-default bg-color-blueDark txt-color-white" value="Update Product" style="display: none;" />
                <input type="button" id="btnCancel"  class="btn btn-default bg-color-blueDark txt-color-white"  value="Go Back" />        
            </div>
        </div>
    </div>
       
</section>
 <jsp:include page="../../includes/loading-no-status.jsp"/>  
<script src="js/buttonset.js"></script>
    
<script type="text/javascript">
    
    pageSetUp();
     
    $("#btnCancel").click(function(){
        var btnCancel = $('#btnCancel').val();
        
        if (btnCancel === 'Go Back'){
            location.href = '#/ProductDetail/' + $('#txtStockCode').val();
        } else if (btnCancel === 'Cancel'){
            location.reload();
        }
    });      
    
    $("#ddlCompany").change(function(){
        
        $('#ddlLocation').empty();
        
        //$(this).find(':selected').text(); <-- text
        var sCompany = this.value;   
        var request = $.ajax({
            type: "GET",
            url: "${pageContext.request.contextPath}/Servlet_Stock?SFC=GET_REL_LOCATION",
            data: {
                COMPANY: sCompany
            },
            dataType: 'json',
            success: function(data) {
                $("select#ddlLocation").append( $("<option>").val("").html("- Select Location -")); 
  
                for (var a=0 ; a<data.object1.length ; a++) {                   
                    var arrData = data.object1[a];                
                    $("select#ddlLocation").append( $("<option>")
                        .val(arrData.VALUE)
                        .html(arrData.VALUE + " - " + arrData.TEXT)
                    ); 
                }
            }
            //error: AjaxError
        });                                                           
        $("#ddlLocation").prop("disabled", false);  
    }); 
    
    function bindData(sParam) {
        $('#txtStockCode').val(sParam.STKCODE);
        $('#txtDefaultUOM').val(sParam.DEFAULTUOM);
        var pagefunction = function () {
            loadScript("js/plugin/jqgrid/ui.multiselect.js", function () {
                loadScript("js/plugin/jqgrid/grid.locale-en.min.js", function () {
                    loadScript("js/plugin/jqgrid/jquery.jqGrid.min.js", function () {
                        loadScript("js/column-chooser.js", function () {
                            run_jqgrid_function();
                        });
                    });
                });
            });
            //loadScript("js/plugin/jqgrid/jquery.jqGrid.min.js", run_jqgrid_function);
            function run_jqgrid_function() {

                var grid = $("#jqgridStkReorder"),
                        gridPager = "#p" + grid.selector.toString().substring(1),
                        conDiv = $("#c" + grid.selector.toString().substring(1)),
                        defaultColName = ['Company', 'Location', 'Reorder Level', 'Reorder Quantity'],
                        defaultColMol = [
                            {name: 'rord_companycode', index: 'rord_companycode', sortable: true},
                            {name: 'rord_locationcode', index: 'rord_locationcode', sortable: true},
                            {name: 'rord_reorderlevel', index: 'rord_reorderlevel', sortable: true},
                            {name: 'rord_reorderqty', index: 'rord_reorderqty', sortable: true}
                        ],
                        mainGridName = grid.selector.toString().substring(1),
                        //temp = readSettings({settingArray:${sessionScope.settings}, defaultColName: defaultColName, defaultColMol: defaultColMol, settingName: mainGridName});//,
                        temp = readSettings({settingArray: "admin", defaultColName: defaultColName, defaultColMol: defaultColMol, settingName: mainGridName}),
                        currentColName = temp[0],
                        currentColMol = temp[1];
                // alert(JSON.stringify(temp));
                grid.jqGrid({
                    url: '${pageContext.request.contextPath}/Servlet_Stock',
                    postData: {
                        SFC: 'GET_STOCKDETAIL_LIST',
                        STOCKCODE: $('#txtStockCode').val(), 
                        DEFAULTUOM: $('#txtDefaultUOM').val(),
                        FUNCTION: 'STOCK_REORDER'
                    },
                    datatype: "json",
                    mtype: 'POST',
                    colNames: currentColName,
                    colModel: currentColMol,
                    // rownumbers: true,
                    gridview: true,
                    rownumWidth: 40,
                    rowNum: 20,
                    rowList: [10, 20, 25, 30, 50, 100],
                    pager: gridPager,
                    //sortname: 'rord_companycode',
                    viewrecords: true,
                    sortorder: 'asc',
                    toolbarfilter: true,
                    autowidth: true,
                    shrinkToFit: true,
                    loadonce: false,
                    height: 'auto',
                    scrollerbar: false,
                    sortable: {
                        update: function (relativeColumnOrder) {
                            //sortColumn({settingArray:${sessionScope.settings}, order: relativeColumnOrder, grid: grid, defaultColMol: defaultColMol, settingName: mainGridName});
                            sortColumn({settingArray: "admin", order: relativeColumnOrder, grid: grid, defaultColMol: defaultColMol, settingName: mainGridName});
                        }
                    },
                    loadComplete: function () {
                        var iLastPage = parseInt($(this).getGridParam('lastpage'));
                        $(".ui-jqgrid .ui-pg-input").keydown(function (e) {
                            this.value = this.value.replace(/\D/g, '');
                            var code = e.keyCode || e.which;
                            if (code === 13) {
                                if (this.value > iLastPage) {
                                    this.value = iLastPage;
                                } else if (this.value <= 0) {
                                    this.value = 1;
                                }
                            }
                        });
                    }
                });

                // remove classes
                $(".ui-jqgrid").removeClass("ui-widget ui-widget-content");
                $(".ui-jqgrid-view").children().removeClass("ui-widget-header ui-state-default");
                $(".ui-jqgrid-labels, .ui-search-toolbar").children().removeClass("ui-state-default ui-th-column ui-th-ltr");
                $(".ui-jqgrid-pager").removeClass("ui-state-default");
                $(".ui-jqgrid").removeClass("ui-widget-content");
                // add classes
                $(".ui-jqgrid-htable").addClass("table table-bordered table-hover");
                $(".ui-jqgrid-btable").addClass("table table-bordered table-striped");
                $(".ui-pg-div").removeClass().addClass("btn btn-sm btn-primary");
                $(".ui-icon.ui-icon-plus").removeClass().addClass("fa fa-plus");
                $(".ui-icon.ui-icon-pencil").removeClass().addClass("fa fa-pencil");
                $(".ui-icon.ui-icon-trash").removeClass().addClass("fa fa-trash-o");
                $(".ui-icon.ui-icon-search").removeClass().addClass("fa fa-search");
                $(".ui-icon.ui-icon-refresh").removeClass().addClass("fa fa-refresh");
                $(".ui-icon.ui-icon-disk").removeClass().addClass("fa fa-save").parent(".btn-primary").removeClass("btn-primary").addClass("btn-success");
                $(".ui-icon.ui-icon-cancel").removeClass().addClass("fa fa-times").parent(".btn-primary").removeClass("btn-primary").addClass("btn-danger");
                $(".ui-icon.ui-icon-seek-prev").wrap("<div class='btn btn-sm btn-default'></div>");
                $(".ui-icon.ui-icon-seek-prev").removeClass().addClass("fa fa-backward");
                $(".ui-icon.ui-icon-seek-first").wrap("<div class='btn btn-sm btn-default'></div>");
                $(".ui-icon.ui-icon-seek-first").removeClass().addClass("fa fa-fast-backward");
                $(".ui-icon.ui-icon-seek-next").wrap("<div class='btn btn-sm btn-default'></div>");
                $(".ui-icon.ui-icon-seek-next").removeClass().addClass("fa fa-forward");
                $(".ui-icon.ui-icon-seek-end").wrap("<div class='btn btn-sm btn-default'></div>");
                $(".ui-icon.ui-icon-seek-end").removeClass().addClass("fa fa-fast-forward");
                $(".ui-pg-input").addClass("pg-input");

                // resize Stock Supplier Grid
                $(window).on('resize', function () {
                    grid.jqGrid('setGridWidth', conDiv.width());
                });
                grid.on('myRefresh', function () {
                    resizeWidth({grid: grid, gridDiv: conDiv});
                });
    //         quickSetupChooser({grid: grid, defaultColMol: defaultColMol, settingName: mainGridName,
    //            settingArray:${sessionScope.settings},
                quickSetupChooser({grid: grid, defaultColMol: defaultColMol, settingName: mainGridName,
                    settingArray: "admin",
                    done: function () {
                        resizeWidth({grid: grid, gridDiv: conDiv});
                    }
                });
                grid.jqGrid('setGridWidth', conDiv.width());
            };
        };
        loadScript("js/plugin/jqgrid/grid.locale-en.min.js", pagefunction); 
    }
    
    function enableEdit() {
     
        $.showLoadingNoStatus();
        $("#ddlLocation").prop("disabled", true);
        $('#btnCancel').val('Cancel');
        document.getElementById('btnSave').style.display = '';
        document.getElementById('btnEdit').style.display = 'none';  
 
        document.getElementById('tbStkReorder').style.display = '';
        document.getElementById('gridStkReorderSummary').style.display = '';
        document.getElementById('dvStkReorder').style.display = 'none';

        var allRowsInGrid = jQuery("#jqgridStkReorder").jqGrid('getRowData');
   
        for (var i = 0; i < allRowsInGrid.length; i++)
        {
            var $table = $(this).closest('table'),
                CompCode = allRowsInGrid[i].rord_companycode,
                LocCode = allRowsInGrid[i].rord_locationcode,
                ReorderLvl = allRowsInGrid[i].rord_reorderlevel,
                ReorderQty = allRowsInGrid[i].rord_reorderqty;

            $("#myTable tbody").append("<tr>" +
                "<td width='15%'>" +
                "<button type='button' class='editSummaryGrid' onclick='summaryEdit(this);'><span class='glyphicon glyphicon-pencil'></span>Edit</button>&nbsp;\n\
                 <button type='button' class='editSummaryGrid' onclick='summaryDelete(this);'><span class='glyphicon glyphicon-trash'></span>Delete</button>\n\
                 <button type='button' class='DeleteSummaryGrid' onclick='UndoDelete(this);'>Undo</button>\n\
                 <button  class='btnSummaryGrid' onclick='saveSummaryChanges(this);'><span class='glyphicon glyphicon-save'></span>Save</button>&nbsp;\n\
                 <button  class='btnSummaryGrid' onclick='summaryCancel(this);'>Cancel</button>\n\
                </td>" +
                "<td width='20%' style='display:none;'><label class='lblFunction'>NO</label></td>" +
                "<td width='20%'><label class='labelCompCode'>" + CompCode + "</label><input type='text' class='modalCompCode' ID='editCompCode" + i + "' readonly disabled='disabled' style='display:none;width:200px;border:none;background:#FFFFFF;' /></td>" +
                "<td width='20%'><label class='labelLocCode'>" + LocCode + "</label><input type='text' class='modalLocCode' ID='editLocCode" + i + "' readonly disabled='disabled' style='display:none;width:200px;border:none;background:#FFFFFF;' /></td>" +
                "<td width='20%'><label class='labelReorderLvl'>" + ReorderLvl + "</label><input type='text' class='modalReorderLvl' value=" + ReorderLvl + " style='display:none;width:200px;border:none;background:#FFFFFF;' /></td>" +
                "<td width='20%'><label class='labelReorderQty'>" + ReorderQty + "</label><input type='text' class='modalReorderQty' value=" + ReorderQty + " style='display:none;width:200px;border:none;background:#FFFFFF;' /></td>" 
            + "</tr>");
    
            $('input#editCompCode'+i).val(CompCode);
            $('input#editLocCode'+i).val(LocCode);
            $(".editSummaryGrid").show();
            $(".DeleteSummaryGrid").hide();
            $(".btnSummaryGrid").hide();
            $('#ddlCompany').val('');
            $('#ddlLocation').val('');
            $('#txtReorderLvl').val(''); 
            $('#txtReorderQty').val('');     
        }    
        $.hideLoadingNoStatus();
    }
    
    function add_StkReorder() {
        //append data of added row into table
        
        if (($('#ddlCompany').val() === "" || $('#ddlLocation').val() === "") || ($('#txtUnitCost').val() === "" && $('#txtUnitCost').val() === "")) {
            $.bigBoxFail({
                title: "Create Stock Supplier Fail.",
                content: "Create Stock Supplier Fail.",
                timeout: 6000
            });
            return false;
        }
        var $table = $(this).closest('table'),
            CompCode = $("#ddlCompany option:selected").text(),// $('#ddlCompany').val()
            LocCode = $("#ddlLocation option:selected").text(), //$('#ddlLocation').val(),
            ReorderLvl = $('#txtReorderLvl').val(),
            ReorderQty = $('#txtReorderQty').val();

        $("#myTable tbody").append("<tr>" +
                "<td>" +
                "<button type='button' class='editSummaryGrid' onclick='summaryEdit(this);'><span class='glyphicon glyphicon-pencil'></span>Edit</button>&nbsp;\n\
                 <button type='button' class='editSummaryGrid' onclick='summaryDelete(this);'><span class='glyphicon glyphicon-trash'></span>Delete</button>\n\
                 <button style='display:none;' type='button' class='DeleteSummaryGrid' onclick='UndoDelete(this);'>Undo</button>\n\
                 <button style='display:none;' class='btnSummaryGrid' onclick='saveSummaryChanges(this);'><span class='glyphicon glyphicon-save'></span>Save</button>&nbsp;\n\
                 <button style='display:none;' class='btnSummaryGrid' onclick='summaryCancel(this);'>Cancel</button>\n\
                </td>" +
                 "<td width='20%' style='display:none;'><label class='lblFunction'>INSERT</label></td>" +
                "<td width='20%'><label class='labelCompCode'>" + CompCode + "</label><input type='text' class='modalCompCode' disabled='disabled' value=" + CompCode + "  style='display:none;width:200px;border:none;background:#FFFFFF;' /></td>" +
                "<td width='20%'><label class='labelLocCode'>" + LocCode + "</label><input type='text' class='modalLocCode' disabled='disabled' value=" + LocCode + "  style='display:none;width:200px;border:none;background:#FFFFFF;' /></td>" +
                "<td width='20%'><label class='labelReorderLvl'>" + ReorderLvl + "</label><input type='text' class='modalReorderLvl'  value=" + ReorderLvl + "  style='display:none;width:200px;border:none;background:#FFFFFF;' /></td>" +
                "<td width='20%'><label class='labelReorderQty'>" + ReorderQty + "</label><input type='text' class='modalReorderQty'  value=" + ReorderQty + "  style='display:none;width:200px;border:none;background:#FFFFFF;' /></td>" 
            + "</tr>");
        
        $('#ddlCompany').val('');
        $('#ddlLocation').val('');
        $('#txtReorderLvl').val('');
        $('#txtReorderQty').val('');
        $("#ddlLocation").prop("disabled", true);
    }  
    
    function summaryDelete(e) {

        //$(e).closest('tr').remove();       
        var closestTR = $(e).closest('tr');

        closestTR.find('label.lblFunction').html('DELETE');

        closestTR.find('td').prop('disabled', false);
        closestTR.find('td').css('background', '#800000');

        closestTR.find('button.DeleteSummaryGrid').show();
        closestTR.find('button.editSummaryGrid').hide();
        closestTR.find('button.btnSummaryGrid').hide();
    }
    
    function UndoDelete(e) {
        var closestTR = $(e).closest('tr'),
            modalCompCode = closestTR.find('input.modalCompCode').val(),
            modalLocCode = closestTR.find('input.modalLocCode').val(),
            modalReorderLvl = closestTR.find('input.modalReorderLvl').val(),
            modalReorderQty = closestTR.find('input.modalReorderQty').val();

        closestTR.find('label.labelCompCode').html(modalCompCode);
        closestTR.find('label.labelLocCode').html(modalLocCode);
        closestTR.find('label.labelReorderLvl').html(modalReorderLvl);
        closestTR.find('label.labelReorderQty').html(modalReorderQty);
        closestTR.find('label.lblFunction').html('NO');

        closestTR.find('td').prop('disabled', false);
        // $closestTR.find('input').css('class', 'form-control searchbox-text');
        closestTR.find('td').css('background', 'transparent');

        closestTR.find('button.DeleteSummaryGrid').hide();
        closestTR.find('button.editSummaryGrid').show();
        closestTR.find('button.btnSummaryGrid').hide();

        $(e).closest('tr').find('td').each(function () {
            // $(this).find('label').css('background', 'transparent');
            //$(this).find('input').hide();
        });
    }
    
    function summaryEdit(e) {

        var $this = $(e),
            $td = $this.closest('td'),
            $tr = $this.closest('tr');
        $tr.find('td').each(function () {
            $(this).find('label').hide();
            $(this).find('input').show();
        });
        var btnSummaryGrid = $td.find('button.btnSummaryGrid'),
                editSummaryGrid = $td.find('button.editSummaryGrid'),
                $closestTR = $this.closest('tr');

        $closestTR.find('input').prop('disabled', false);
        // $closestTR.find('input').css('class', 'form-control searchbox-text');
        $closestTR.find('input').css('border', '1px solid #ccc');

        //$closestTR.find('input#editCompCode').prop('disabled', false);
        $closestTR.find('input.modalCompCode').prop('disabled', false);
        $closestTR.find('input.modalCompCode').css('border', '1px solid #fff');       
        $closestTR.find('input.modalLocCode').prop('disabled', false);
        $closestTR.find('input.modalLocCode').css('border', '1px solid #fff');

        $closestTR.find('button.editSummaryGrid').hide();
        $closestTR.find('button.btnSummaryGrid').show();
    }

    function summaryCancel(e) {
        $(e).closest('tr').find('button.editSummaryGrid').show();
        $(e).closest('tr').find('button.btnSummaryGrid').hide();
         
        $(e).closest('tr').find('input').prop('disabled', true);
        $(e).closest('tr').find('input').css('border', 'none');
        $(e).closest('tr').find('td').each(function () {
            $(this).find('label').show();
            $(this).find('input').hide();
        });
    }

    function saveSummaryChanges(e) {
        
        var closestTR = $(e).closest('tr'),
            modalCompCode = closestTR.find('input.modalCompCode').val(),
            modalLocCode = closestTR.find('input.modalLocCode').val(),
            modalReorderLvl = closestTR.find('input.modalReorderLvl').val(),
            modalReorderQty = closestTR.find('input.modalReorderQty').val();
 
        closestTR.find('label.labelCompCode').html(modalCompCode);
        closestTR.find('label.labelLocCode').html(modalLocCode);
        closestTR.find('label.labelReorderLvl').html(modalReorderLvl);
        closestTR.find('label.labelReorderQty').html(modalReorderQty);   
        closestTR.find('label.lblFunction').html('UPDATE');

        closestTR.find('button.editSummaryGrid').show();
        closestTR.find('button.btnSummaryGrid').hide();
        closestTR.find('button.DeleteSummaryGrid').hide();
    
        $(e).closest('tr').find('input').prop('disabled', true);
        $(e).closest('tr').find('input').css('border', 'none');
        $(e).closest('tr').find('td').each(function () {
            $(this).find('label').show();
            $(this).find('input').hide();
        });
    }          
    
    $("#btnSave").click(function () {
        
        var StkReorderData = new Array();
        $('#myTable tr').each(function (row, th) {
            var Company = $(th).find('td:eq(2)').text(); 
            var substrComp = Company.split(" - ");
            var CompCode = substrComp[0];
            
            var Location = $(th).find('td:eq(3)').text();
            var substrLoc = Location.split(" - ");
            var LocCode = substrLoc[0];
        
            StkReorderData[row] = {
                "FUNCTION": $(th).find('td:eq(1)').text(),
                "COMPANY": CompCode,
                "LOCATION": LocCode,
                "REORDERLVL": $(th).find('td:eq(4)').text(),
                "REORDERQTY": $(th).find('td:eq(5)').text(),
                "STOCKCODE": $('#txtStockCode').val(),
                "DEFAULTUOM": $('#txtDefaultUOM').val()
            };
        });
        StkReorderData.splice(0, 1);

        var ItemToSend = JSON.stringify(StkReorderData);
        $('#hidStkReorder').load().val(ItemToSend).valid();
        //alert($('#hidStkReorder').val());

        var request = $.ajax({
            type: "POST",
            url: "${pageContext.request.contextPath}/Servlet_Stock?SFC=UPDATE_STOCK_REORDER",
            data: {
                STOCKREORDER: $('#hidStkReorder').val()
            },
            dataType: 'json'
            //success: function() {alert("save request SUCCESS");},
           // error: AjaxError
        });

        request.done(function (response) {
            if (response.bool === true) {
                $.bigBoxSuccess({
                    title: "Stock Reorder Updated Successfully.",
                    content: "Stock Reorder Updated Successfully.",
                    timeout: 6000
                });
                setTimeout(function(){
                   location.reload();
                   // location.href = "#/ProductDetail/" + $('#lblPrdCode').val();
                }, 2500);              
            } else {
                $.bigBoxFail({
                    title: "Stock Reorder FAILED To Update.",
                    content: "There is some error during data update.<br> Please try again...",
                    timeout: 6000
                });
                setTimeout(function(){
                   location.reload();
                }, 2500);               
            }
        });     
    });  
</script>