<!--
Modification ID     By      Date        Comment
-------------------------------------------------------------------------------
yesno01             Aaron   18Dec2018   include yes-no.jsp in the code
txt01               Aaron   18Dec2018   add rules and message for description so that it is required to proceed
c01                 Aaron   18Dec2018   add confirmation box and loading screen when user try to create new package
name01              Aaron   27Dec2018   change name for btnSave
font01              Aaron   04Jan2019   change font style and color for mandatory fields
len01               Aaron   04Jan2019   set maxlength for textbox
style01             Aaron   04Jan2019   change display style for Description from textbox to textarea
valid01             Aaron   04Jan2019   add validation for number
-->
<%@taglib prefix="jstl" uri="http://java.sun.com/jsp/jstl/core" %>
<jsp:useBean id="DDL" scope="page" class="BusinessLogic.Servlet_PopulateData" />
<style type="text/css">
    .ui-jqgrid tr.jqgrow td {
        word-wrap: break-word; /* IE 5.5+ CSS3 see http://www.w3.org/TR/css3-text/#text-wrap */
        white-space: pre-wrap; /* CSS3 */
        white-space: -moz-pre-wrap; /* Mozilla, since 1999 */
        white-space: -pre-wrap; /* Opera 4-6 */
        white-space: -o-pre-wrap; /* Opera 7 */
        overflow: hidden;
        height: auto;
        vertical-align: middle;
        padding-top: 3px;
        padding-bottom: 3px 
    }

    .centered {
        position: fixed;
        top: 50%;
        left: 50%;
        margin-top: -50px;
        margin-left: -200px;
    }
    div.errorContainer, div.errorContainer2{
        display:none;
        width:100%;
    }
    div.errorContainer, div.errorContainer2 ol li{
        list-style-type:disc;
        margin-left: 20px;
    }
    select:disabled{
        background: #dddddd;
    }
    li{
        list-style:none;
    }
    .disabledTab{
        pointer-events: none;
    }
    input[type="text"].error { border: 1px solid #A94444; background-color:#FFF0F0; }
    select.error { border: 1px solid #A94444; background-color:#FFF0F0; }
    textarea.error { border: 1px solid #A94444; background-color:#FFF0F0; }
</style>
<link rel="stylesheet" type="text/css" href="css/your_style.css" />
<link rel="stylesheet" type="text/css" href="js/plugin/jqgrid/ui.multiselect.css" />
<section id="widget-grid" class="">
    <!--<span>{{params}}</span>-->
    <input type="hidden" value={{params}} id="hidPackCode">

    <div class="col-xs-12 col-sm-7 col-md-7 col-lg-12">
        <h1 class="page-title txt-color-blueDark">
            <!-- PAGE HEADER -->
            <i class="fa-fw fa fa-file fa-2x"></i> 
            Package Price Setup                                         
        </h1>
    </div>
    <div class="widget-body row">
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="row" style="padding-bottom:10px;padding-left:10px;padding-right:10px;">
                <div class="errorContainer alert alert-danger alert-block">
                    <h4 class="alert-heading">There were some field left out or invalid inputs. Please brief through the form and reenter necessarily.</h4>
                    <ol>
                    </ol>
                </div>
            </div>
            <div class="row">
                <form id="form_AddPackage" name="form_AddPackage">
                    <article class="col-sm-12 col-md-12 col-lg-12">
                        <div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-1"  data-widget-editbutton="false" data-widget-custombutton="false"
                             data-widget-deletebutton="false" data-widget-colorbutton="false" data-widget-fullscreenbutton="false" data-widget-togglebutton="false">
                            <header>
                                <span class="widget-icon"> <i class="fa fa-file"></i></span>
                                <span><h2>&nbsp;Package Header</h2></span>
                            </header>
                            <div class="row">
                                <div class="widget-body">
                                    <table id="tbPackageInfo" class="table table-bordered table-striped" style="clear:both;">
                                        <tbody>
                                            <tr>
                                                <td width="12%"><font color="red">*</font> <b>Package Code<b></td> <!--font01-->
                                                <td width="1%">:</td>
                                                <td width="35%"> 
                                                    <input type="text" id="txtPackCode" name="txtPackCode" required  class="form-control" rel="popover-hover" data-original-title="Package Code" data-content="A Package Code is a unique mixture of alphanumerical code with a maximum length of 10 characters." maxlength="10" /> <!--len01-->   
                                                </td>
                                                <td width="12%"><font color="red">*</font> <b>Status</b></td> <!--font01-->
                                                <td width="1%">:</td>
                                                <td width="35%">   
                                                    <label id="selectStatus" class="searchbox">
                                                        <select class="form-control" id="ddlStatus" name="ddlStatus" rel="popover-hover" data-original-title="Status" data-content="Select Status." style="width:250px;">
                                                            <option value="">- Select Status -</option>       
                                                            <option value="Y">Active</option>
                                                            <option value="N">Inactive</option>
                                                        </select>
                                                    </label>   
                                                </td>
                                            </tr>
                                            <tr>
                                                <td width="12%"><font color="red">*</font> <b>Package Description</b></td> <!--font01-->
                                                <td width="1%">:</td>
                                                <td width="35%">       
                                                    <!--style01-->
                                                    <textarea rows="3" cols="50" id="txtPackDesc" name="txtPackDesc" class="form-control" rel="popover-hover" data-original-title="Package Description" maxlength="100" style="width:440px; resize:none;"/> <!--len01-->    
                                                </td>
                                                <td width="12%">Display/Charge Group</td>
                                                <td width="1%">:</td>
                                                <td width="35%">
                                                    <label id="selectCGRP" class="searchbox">
                                                        <select class="form-control" id="ddlCGRP" name="ddlCGRP" rel="popover-hover" data-original-title="Charge Group" data-content="Select Charge Group" style="width:250px;">
                                                            <option value="">- Select Charge Group -</option>
                                                        </select>
                                                    </label>
                                                </td>                                                
                                            </tr>
                                            <tr>                                                
                                                <td width="12%">Is Immunization Package</td>
                                                <td width="1%">:</td>
                                                <td width="35%"> 
                                                    <label id="selectImPack" class="searchbox">
                                                        <select class="form-control" id="ddlImPack" name="ddlImPack" rel="popover-hover" data-original-title="Immunization Package" data-content="Select is Immunization." style="width:250px;">
                                                            <option value="">- Select Is Immunization -</option>       
                                                            <option value="Y">Yes</option>
                                                            <option value="N">No</option>
                                                        </select>
                                                    </label>                                 
                                                </td>                                                   
                                                <td width="12%">Account Group</td>
                                                <td width="1%">:</td>
                                                <td width="35%">
                                                    <label id="selectACCGRP" class="searchbox">
                                                        <select class="form-control" id="ddlACCGRP" name="ddlACCGRP" rel="popover-hover" data-original-title="Account Group" data-content="Select Account Group" style="width:250px;">
                                                            <option value="">- Select Account Group -</option>
                                                        </select>
                                                    </label>
                                                </td> 
                                            </tr>
                                            <tr>                                                
                                                <td>GST Tax Code (Supply)</td>
                                                <td>:</td>
                                                <td>
                                                    <label id="selectGSTCodeSup" class="searchbox">
                                                        <select class="form-control" id="ddlGSTCodeSup" name="ddlGSTCodeSup" rel="popover-hover" data-original-title="GST Code" data-content="Select GST Code" style="width:250px;">
                                                            <option value="">- Select GST Code (Supply)-</option>
                                                        </select>                                                
                                                    </label>
                                                </td>
                                                <td width="35%" colspan="3"> 
                                                    <table>
                                                        <tr>
                                                            <td>
                                                                <input type="checkbox" id="chkCourse" name="chkCourse" value="Y" onchange="selectCourse()" checked="true" /><label for="chkCourse" class="label-option" width="15px">Is Course</label>                                                    
                                                            </td>
                                                            <td>
                                                                <div class="col-sm-12 col-md-4 col-lg-5">                                                        
                                                                    <input class="form-control spinner-both"  id="txtCourse" name="txtCourse" value="1">
                                                                </div>     
                                                                <label for="txtCourse">Time(s)</label>
                                                            </td>
                                                        </tr>
                                                    </table>                                                    
                                                </td>
                                            </tr>
                                                                             </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </article>
                </form>
            </div>
        </article>
        
        <div>
            <div class="row">
                <div class="col-sm-12">
                    <div align="center" class="padding-5" >
                        <input type="button" Id="btnSave"  class="btn btn-default bg-color-blueDark txt-color-white" value="Save" onclick="confirm();" /> <!--name01-->
                        <input type="button" Id="btnCancel"  class="btn btn-default bg-color-blueDark txt-color-white"  value="Cancel" onclick="location.href = '#/ChargePackageList'" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<jsp:include page="../../../includes/loading-no-status.jsp"/>
<!--yesno01-->
<jsp:include page="../../../includes/yes-no.jsp"/>
<!--<script src="js/buttonset.js"></script>-->
<script type="text/javascript">
    
    getDLL("ddlCGRP", "GET_CODEDESC", "CGPKG", "");
    getDLL("ddlACCGRP", "GET_CODEDESC", "ACCGRP", "");
    getDLL("ddlGSTCodeSup", "GET_ACTIVEGSTCODE", "SUPPLY", "");

    function getDLL (ddl, method, param1, param2) {
        $.get('${pageContext.request.contextPath}/Servlet_PopulateData', {SFC: 'GET_DLL', METHOD: method, P1: param1, P2: param2}, function (data) {
            for(var i=0; i < data.length; i++){                                                          
                $("#"+ddl).append($("<option>").val(data[i].VALUE).html(data[i].TEXT));
            }     
        });     
    }       
 
    var pagefunction = function () {
           $().ready(function () {
            $(".numeric").numeric();
            var container = $('div.errorContainer');
            //$('#loadingModal').modal('show');

            var validator = $("#form_AddPackage").validate({
                rules: {
                    txtPackCode: "required",
                    ddlStatus: "required",
                    txtPackDesc: "required" //txt01
                  //  rdPrdCat: "required"
                },
                messages: {
                    txtPackCode: "Package Code cannot be blank.",
                    ddlStatus: "Status must be selected.",
                    txtPackDesc: "Package Description cannot be blank" //txt01
                 //   rdPrdCate: "Product category must be selected."
                },
                errorContainer: container,
                errorLabelContainer: $("ol", container),
                wrapper: 'li'
            });      
        });
    };
    loadScript("js/jquery.numeric.js", pagefunction);
      
    function selectCourse(){
        if (document.getElementById('chkCourse').checked) 
        {
            $('#txtCourse').prop('disabled',false);
        } else {
            $('#txtCourse').prop('disabled',true);
            $('#txtCourse').val('0');                      
        }
    }
    
    //valid01
    function intNum(num){
        var reg = /^[0-9]+$/;
        if (num === ""){
            return true;
        }
        else{
            return reg.test(num);
        }
    }
    //c01
    function confirm(){
        var $validPackage = $("#form_AddPackage").valid();
        var $validCourse = intNum($('#txtCourse').val()); //valid01
        if ($validPackage === true && $validCourse === true) {
            document.getElementById("btnSave").disabled = true;
            showYesNo({
               title: "Confirmation needed",
               width: 420,
               noClose: true,
               isModal: true,
               body: [
                   "<br><h4>Please confirm all the details entered.<h4><br>"
               ],
               show: function(){},
               Yes: {
                   text: "Yes",
                   opt: function(){
                       createNew();
                       hideYesNo();
                   }
               },
               No: {
                   text: "No",
                   opt: function(){
                       document.getElementById("btnSave").disabled = false;
                       hideYesNo();
                   }
               }
            });
        }
        //valid01
        else if($validCourse === false){
            $.bigBoxFail({
                title: "Invalid Course Time.",
                content: "Please enter a valid course number and try again...",
                timeout: 6000
            });
        }
    }
    
    //c01
    function createNew(){
        var $this = $(this);

        $.ajax({
                type: "POST",
                url: "${pageContext.request.contextPath}/Servlet_ChargePackage?SFC=INSERT_PACKAGE",
                data: {
                    ADDPACK: JSON.stringify($('#form_AddPackage').serializeArray()),
                    MODE: "ADD_PACKAGEHEADER"
                },
                dataType: 'json',
                beforeSend: function (xhr) {
                    $.showLoadingNoStatus();
                },
                success: function(response,xhr,status){
                if (response.bool === true) {
                    $.bigBoxSuccess({
                        title: "Create Package SUCCESS.",
                        content: "Package creation SUCCESS.",
                        timeout: 6000
                    });
                    }
                    else{
                    $.bigBoxFail({
                        title: "Create Package FAIL.",
                        content: "There is some error during package creation.<br> Please try again...",
                        timeout: 6000
                    });
                }
                },
                error: function(xhr,status,error){
                  $.bigBoxFail({
                        title: "Transaction ERROR",
                        content: "There is some error occur during data transfer. Please try again later",
                        timeout: 6000
            });
                },
                complete: function(xhr,status){
                    if (xhr.status === 200) {
                        $.hideLoadingNoStatus(function () {
                           window.location.href = "#/PackageDetail/" + $('#txtPackCode').val();
                        }, 500);
                } else {
                    $.hideLoadingNoStatus(function () {
                    }, 0);
                }
        }
    });
    }
    //c01   
    pagefunction();
</script>
