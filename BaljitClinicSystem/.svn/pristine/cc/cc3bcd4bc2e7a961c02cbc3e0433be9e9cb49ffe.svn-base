<!--
Modification ID     By      Date        Comment
--------------------------------------------------------------------------------
c01                 Aaron   18Dec2018   add confirmation box and loading status when user try to update existing record
font01              Aaron   04Jan2019   change font style and font color for mandatory fields
len01               Aaron   04Jan2019   set maxlength for textbox
style01             Aaron   04Jan2019   change input style for Description from textbox to textarea
valid01             Aaron   07Jan2019   add validation for numbers and validation for form
type01              Aaron   07Jan2019   change input type from number to text
gg01                    Aaron   08Jan2019   add condition to remove box shadow
-->
<%@taglib prefix="jstl" uri="http://java.sun.com/jsp/jstl/core" %>
<jsp:useBean id="DDL" scope="page" class="BusinessLogic.Servlet_PopulateData" />
<style type="text/css">
    .ui-jqgrid tr.jqgrow td {
        word-wrap: break-word; /* IE 5.5+ CSS3 see http://www.w3.org/TR/css3-text/#text-wrap */
        white-space: pre-wrap; /* CSS3 */
        white-space: -moz-pre-wrap; /* Mozilla, since 1999 */
        white-space: -pre-wrap; /* Opera 4-6 */
        white-space: -o-pre-wrap; /* Opera 7 */
        overflow: hidden;
        height: auto;
        vertical-align: middle;
        padding-top: 3px;
        padding-bottom: 3px 
    }
    .centered {
        position: fixed;
        top: 50%;
        left: 50%;
        margin-top: -50px;
        margin-left: -200px;
    }
    div.errorContainer, div.errorContainer2{
        display:none;
        width:100%;
    }
    div.errorContainer, div.errorContainer2 ol li{
        list-style-type:disc;
        margin-left: 20px;
    }
    li{
        list-style:none;
    }
    .disabledTab{
        pointer-events: none;
    }
    input[type="text"].error { border: 1px solid #A94444; background-color:#FFF0F0; }
    textarea.error { border: 1px solid #A94444; background-color:#FFF0F0; }
    .rightJustified {
        text-align: right;
    }
    /*gg01*/
    input[type="text"]:read-only {box-shadow: none;}
    textarea:read-only {box-shadow: none;}
</style>
<link rel="stylesheet" type="text/css" href="css/your_style.css" />
<link rel="stylesheet" type="text/css" href="js/plugin/jqgrid/ui.multiselect.css" />
<section id="widget-grid" class="">
    <input type="hidden" value={{params}} id="hidHospCode">
    <div class="col-xs-12 col-sm-7 col-md-7 col-lg-12">
        <h1 class="page-title txt-color-blueDark">
            <!-- PAGE HEADER -->
            <i class="fa-fw fa fa-file fa-2x"></i> 
            Package Price Setup                                         
        </h1>
    </div>
    <div class="widget-body row">
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="row" style="padding-bottom:10px;padding-left:10px;padding-right:10px;">
                <div class="errorContainer alert alert-danger alert-block">
                    <h4 class="alert-heading">There were some field left out or invalid inputs. Please brief through the form and reenter necessarily.</h4>
                    <ol id="error_list">
                    </ol>
                </div>
            </div>           
            <div class="row">
                <form id="form_PackageHdrDetail" name="form_PackageHdrDetail" method="post">
                    <article class="col-sm-12 col-md-12 col-lg-12">
                        <div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-1"  data-widget-editbutton="false" data-widget-custombutton="false"
                             data-widget-deletebutton="false" data-widget-colorbutton="false" data-widget-fullscreenbutton="false" data-widget-togglebutton="false">
                            <header>
                                <span class="widget-icon"> <i class="fa fa-file"></i></span>
                                <span><h2>&nbsp;Package Header Info</h2></span>
                            </header>
                            <div class="row">
                                <div class="widget-body">
                                    <table id="table2" class="table table-bordered table-striped" style="clear:both;">
                                        <tbody>                                           
                                            <tr>
                                                <td width="14%"><font color="red">*</font> <b>Package Code</b></td> <!--font01-->
                                                <td width="1%">:</td>
                                                <td width="35%"> 
                                                    <input type="text" id="txtPackCode" name="txtPackCode" readonly class="tboxreadonly" />    
                                                </td>
                                                <td width="14%"><font color="red">*</font> <b>Status</b></td> <!--font01-->
                                                <td width="1%">:</td>
                                                <td width="35%">  
                                                    <input type="text" id="lblStatus" name="lblStatus" readonly class="tboxreadonly"/>
                                                    <label id="selectStatus" class="searchbox" style="display:none;">
                                                        <select class="form-control" id="ddlStatus" name="ddlStatus" style="width:250px;">
                                                            <option value="">- Select Status -</option>       
                                                            <option value="Y">Active</option>
                                                            <option value="N">Inactive</option>
                                                        </select>
                                                    </label>   
                                                </td>
                                            </tr>
                                            <tr>
                                                <td><font color="red">*</font> <b>Package Description</b></td> <!--font01-->
                                                <td>:</td>
                                                <td>     
                                                    <!--style01-->
                                                    <textarea rols="3" cols="50" id="lblPackDesc" name="lblPackDesc" readonly class="tboxreadonly" maxlength="100" style="width:440px; resize:none;"/>
                                                    <textarea rols="3" cols="50" id="txtPackDesc" name="txtPackDesc" class="form-control" style="display:none;width:440px;resize:none;" maxlength="100"/>   <!--len01-->  
                                                </td>
                                                <td>Display/Charge Group</td>
                                                <td>:</td>
                                                <td>
                                                    <input type="text" id="lblCGRP" name="lblCGRP" readonly class="tboxreadonly"/>
                                                    <label id="selectCGRP" class="searchbox" style="display:none;">
                                                        <select class="form-control" id="ddlCGRP" name="ddlCGRP" style="width:250px;">
                                                            <option value="">- Select Charge Group -</option>
                                                        </select>
                                                    </label>
                                                </td>                                                
                                            </tr>
                                            <tr>                                                
                                                <td>Is Immunization Package</td>
                                                <td>:</td>
                                                <td> 
                                                    <input type="text" id="lblImPack" name="lblImPack" readonly class="tboxreadonly"/>
                                                    <label id="selectImPack" class="searchbox" style="display:none;">
                                                        <select class="form-control" id="ddlImPack" name="ddlImPack" style="width:250px;">
                                                            <option value="">- Select Is Immunization -</option>       
                                                            <option value="Y">Yes</option>
                                                            <option value="N">No</option>
                                                        </select>
                                                    </label>                                 
                                                </td>                                                   
                                                <td>Account Group</td>
                                                <td>:</td>
                                                            <td>
                                                    <input type="text" id="lblACCGRP" name="lblACCGRP" readonly class="tboxreadonly"/>
                                                    <label id="selectACCGRP" class="searchbox" style="display:none;">
                                                        <select class="form-control" id="ddlACCGRP" name="ddlACCGRP" style="width:250px;">
                                                            <option value="">- Select Account Group -</option>
                                                        </select>
                                                    </label>
                                                </td>
                                            </tr>
                                            <tr>                                                
                                                <td>GST Tax Code (Supply)</td>
                                                <td>:</td>
                                                <td>
                                                    <input type="text" id="lblGSTCodeSup" name="lblGSTCodeSup" readonly class="tboxreadonly"/>
                                                    <label id="selectGSTCodeSup" class="searchbox" style="display:none;">
                                                        <select class="form-control" id="ddlGSTCodeSup" name="ddlGSTCodeSup" style="width:250px;">
                                                            <option value="">- Select GST Code (Supply)-</option>
                                                        </select>                                                
                                                    </label>
                                                </td>
                                                <td colspan="3"> 
                                                    <table>
                                                        <tr>
                                                            <td>
                                                                <input type="checkbox" id="chkCourse" name="chkCourse" disabled="disabled"/><label for="chkCourse" class="label-option" width="15px">Is Course</label>                                                    
                                                            </td>
                                                            <td>
                                                                <div class="col-sm-12 col-md-4 col-lg-5">                                                        
                                                                    <!--type01-->
                                                                    <input type="text" class="form-control" id="txtCourse" name="txtCourse" min="0" disabled="disabled">
                                                                </div>     
                                                                <label for="txtCourse">Time(s)</label>
                                                            </td>
                                                        </tr>
                                                    </table>                                                    
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-2"  data-widget-editbutton="false" data-widget-custombutton="false"
                             data-widget-deletebutton="false" data-widget-colorbutton="false" data-widget-fullscreenbutton="false" data-widget-togglebutton="false">
                            <header>
                                <span class="widget-icon"> <i class="fa fa-file"></i></span>
                                <span><h2>&nbsp;Package Prices Info</h2></span>
                            </header>
                            <div class="row">
                                <div class="widget-body">
                                    <table id="table1" class="table table-bordered table-striped" style="clear:both;">
                                        <tbody>                                           
                                            <tr>
                                                <td width="10%">Price 1 (Low)</td>
                                                <td width="1%">:</td>
                                                <td width="20%"> 
                                                    <input type="text" id="lblPrice1" name="lblPrice1" readonly class="tboxreadonly"/>
                                                    <!--type01-->
                                                    <input type="text" min="0" id="txtPrice1" name="txtPrice1" placeholder="Package Price 1" style="width:100px;display:none;text-align:right;" class="form-control"/>    
                                                </td>
                                                <td width="13%">Price 2 (Moderate)</td>
                                                <td width="1%">:</td>
                                                <td width="20%">       
                                                    <input type="text" id="lblPrice2" name="lblPrice2" readonly class="tboxreadonly"/>
                                                    <!--type01-->
                                                    <input type="text" min="0" id="txtPrice2" name="txtPrice2" placeholder="Package Price 2" style="width:100px;display:none;text-align:right;" class="form-control"/>    
                                                </td>
                                                <td width="10%" rowspan="2">Original Total Price</td>
                                                <td width="1%" rowspan="2">:</td>
                                                <td width="34%" rowspan="2">       
                                                    $&nbsp;<input type="text" id="lblOriPrice" name="lblOriPrice" value=0.00 readonly class="tboxreadonly" style="width:100px;"/>                                                   
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Price 3 (High)</td>
                                                <td>:</td>
                                                <td> 
                                                    <input type="text" id="lblPrice3" name="lblPrice3" readonly class="tboxreadonly"/>
                                                    <!--type01-->
                                                    <input type="text" min="0" id="txtPrice3" name="txtPrice3" placeholder="Package Price 3" style="width:100px;display:none;text-align:right;" class="form-control"/>    
                                                </td>
                                                <td>Price 4 (Premium)</td>
                                                <td>:</td>
                                                <td>       
                                                    <input type="text" id="lblPrice4" name="lblPrice4" readonly class="tboxreadonly"/>
                                                    <!--type01-->
                                                    <input type="text" min="0" id="txtPrice4" name="txtPrice4" placeholder="Package Price 4" style="width:100px;display:none;text-align:right;" class="form-control"/>    
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>                       
                    </article>  
                </form>
            </div>
            <div class="jarviswidget" id="wid-id-3"  data-widget-editbutton="false" data-widget-custombutton="false" data-widget-deletebutton="false" 
                data-widget-colorbutton="false" data-widget-fullscreenbutton="false" data-widget-togglebutton="false" style="float:left;width:40%;display:none;">
                <ul id="myTab1" class="nav nav-tabs bordered">
                    <li class="active">
                        <a id="tab1" href="#s1" data-toggle="tab"></a>
                    </li>
                    <li>
                        <a id="tab2" href="#s1" data-toggle="tab"></a>
                    </li>
                    <li>
                        <a id="tab3" href="#s1" data-toggle="tab"></a>
                    </li>
                    <li>
                        <a id="tab4" href="#s1" data-toggle="tab"></a>
                    </li>
                </ul>
                <div id="tabContent" class="tab-content padding-10">
                    <div class="tab-pane fade in active" id="s1">
                        <div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-4"  data-widget-editbutton="false" data-widget-custombutton="false"
                            data-widget-deletebutton="false" data-widget-colorbutton="false" data-widget-fullscreenbutton="false" data-widget-togglebutton="false">
                            <header>
                                <div style="text-align:center;"><span><h2>&nbsp;Available Package Item</h2></span></div>
                            </header>                                
                            <!-- widget content -->
                            <div class="widget-body">
                                <div class="table-responsive">
                                    <div id="cjqgridPrdList"></div>
                                    <table id="jqgridPrdList" class="table table-striped table-bordered"  ></table>
                                    <div id="pjqgridPrdList"></div>
                                </div>
                            </div>
                            <!-- end widget content -->
                        </div>  
                    </div>
                </div>
            </div>
            <div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-5" data-widget-editbutton="false" 
                data-widget-deletebutton="false" data-widget-colorbutton="false" data-widget-fullscreenbutton="false" data-widget-togglebutton="false" style="float:right;width:60%;display:none;">
                <header>
                    <div style="text-align:center;"><span><h2>&nbsp;Selected Package Item</h2></span></div>
                </header>
                <div class="container">
                    <div class="row">
                        <div id="cjqgridSubmitDetail" class="jqgrid-table-nopadding">
                            <div class="table-responsive">                                        
                                <div id="gridItemSummary" class="">                              
                                    <table class="table table-striped" id="tbItem" >
                                        <thead>                                                                                                          
                                            <th id="lblEditDel"> </th>  
                                            <th id="lblItemCode">Item Code</th>
                                            <th id="lblItemDesc">Description</th>
                                            <th id="lblGroup">Group</th>
                                            <th id="lblCategory">Category</th>
                                            <th id="lblItemPrice">Item Price</th>
                                            <th id="lblRemark">Remark</th> 
                                            <th id="lblFunction"> </th>
                                        </thead>
                                        <tbody id="ItemGrid" >
                                        </tbody>
                                    </table>
                                </div>  
                            </div>
                        </div>
                    </div>                               
                </div>
            </div>  
        </article>
        <div>
            <div class="row">
                <div class="col-sm-12">
                    <div align="center" class="padding-5" >
                        <input type="button" Id="btnSave"  class="btn btn-default bg-color-blueDark txt-color-white" value="Edit Detail" style="margin-right:20px;"/>
                        <input type="button" Id="btnCancel"  class="btn btn-default bg-color-blueDark txt-color-white"  value="Cancel" onclick="location.href = '#/ChargePackageList'" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-dialog" style="width:50%;">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                &times;
            </button>
            <h4 class="modal-title" id="myModalLabel2">Add/Edit Package Item</h4>
        </div>
        <div class="modal-body">
            <div class="widget-body">
            <div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-6" data-widget-custombutton="false" data-widget-editbutton="false" data-widget-deletebutton="false" data-widget-colorbutton="false" data-widget-fullscreenbutton="false" data-widget-togglebutton="false">
                <header>
                    <h2>Package Item Details</h2>
                </header>
                <div class="container">
                    <div class="row">   
                        <div id="sourceDetail">      
                            <table id="tblItemDetail" class="selection-criteria">
                                <tr>
                                    <td width="30%" style="text-align:right;">Package : </td>
                                    <td width="70%">                                            
                                        <label id="lblPckCode" class="searchbox"></label>                           
                                    </td>
                                </tr>
                                <tr>
                                    <td style="text-align:right;">Package Description : </td>
                                    <td>                                            
                                        <label id="lblPckDesc" class="searchbox"></label>                           
                                    </td>
                                </tr>
                            </table><hr>
                            <table id="tblItemDetail2" class="selection-criteria">
                                <tr>
                                    <td width="30%" style="text-align:right;">Charge Category : </td>
                                    <td width="70%">                                            
                                        <label id="lblChgCat" class="searchbox"></label>                           
                                    </td>
                                </tr> 
                                <tr>
                                    <td style="text-align:right;">Charge Group : </td>
                                    <td>                                            
                                        <label id="lblChgGrp" class="searchbox"></label>                           
                                    </td>
                                </tr> 
                                <tr>
                                    <td style="text-align:right;">Charge Code : </td>
                                    <td>                                            
                                        <label id="lblChgCode" class="searchbox"></label>                           
                                    </td>
                                </tr> 
                                <tr>
                                    <td style="text-align:right;">Charge Description : </td>
                                    <td>                                            
                                        <label id="lblChgDesc" class="searchbox"></label>                           
                                    </td>
                                </tr> 
                                <tr>
                                    <td style="text-align:right;"><font color="red">*</font> Charge Price : </td> <!--font01-->
                                    <td>
                                        <input type="number" min="0" id="txtChgPrice" name="txtChgPrice" style="width:150px;" class="form-control"/> 
                                    </td>
                                </tr> 
                                <tr>
                                    <td style="text-align:right;">Remark : </td>
                                    <td>                                            
                                        <!--style01-->
                                        <textarea cols="5" rows="3" id="txtRemark" name="txtRemark" style="resize:none;width:400px;" class="form-control" maxlength="250"/> <!--len01-->                           
                                    </td>
                                </tr> 
                            </table>
                        </div>           
                    </div>
                </div>               
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <div align="Center" class="padding-5" >   
                        <input type="button" Id="btnOK" class="btn btn-default bg-color-blueDark txt-color-white" value="OK" style=" width:80px;margin-right:20px;" data-dismiss="modal" />
                        <input type="button" Id="btnCancel" class="btn btn-default bg-color-blueDark txt-color-white" value="Cancel" style=" width:80px;" data-dismiss="modal" />
                    </div>
                </div>
            </div>                
            </div>           
        </div>        
    </div>
</div>
</div>     
<jsp:include page="../../../includes/yes-no.jsp"/>
<jsp:include page="../../../includes/loading-no-status.jsp"/>
<script type="text/javascript">

    pageSetUp();   
    
    getDLL("ddlCGRP", "GET_CODEDESC", "CGPKG", "");
    getDLL("ddlACCGRP", "GET_CODEDESC", "ACCGRP", "");
    getDLL("ddlGSTCodeSup", "GET_ACTIVEGSTCODE", "SUPPLY", "");

    function getDLL (ddl, method, param1, param2) {
        $.get('${pageContext.request.contextPath}/Servlet_PopulateData', {SFC: 'GET_DLL', METHOD: method, P1: param1, P2: param2}, function (data) {
            for(var i=0; i < data.length; i++){                                                          
                $("#"+ddl).append($("<option>").val(data[i].VALUE).html(data[i].TEXT));
            }     
        });     
    }      
    
    var curRow = 0;
    var curRowToEdit = "";
    function bindData(sParam) {  
        var pagefunction = function() {           
            $().ready(function () {                 
                //valid01
                var container = $('div.errorContainer');
                var validator = $("#form_PackageHdrDetail").validate({
                rules: {
                    txtPackCode: "required",
                    ddlStatus: "required",
                    txtPackDesc: "required" //txt01
                  //  rdPrdCat: "required"
                },
                messages: {
                    txtPackCode: "Package Code cannot be blank.",
                    ddlStatus: "Status must be selected.",
                    txtPackDesc: "Package Description cannot be blank" //txt01
                 //   rdPrdCate: "Product category must be selected."
                },
                errorContainer: container,
                errorLabelContainer: $("ol", container),
                wrapper: 'li'
            }); 
                //get package header 
                $.ajax({
                    type:'POST',
                    url:"${pageContext.request.contextPath}/Servlet_ChargePackage",
                    data:  {
                        SFC: 'GET_PACKAGE_HEADER', 
                        PACKCODE: sParam.PACKCODE
                    },
                    dataType: 'json',
                    success: function(data) {                                     
                        var arrData = data.object1[0]; 
                        $('#txtPackCode').val(arrData.pkh_pkhcode);                       
                        $('#lblPackDesc').val(arrData.pkh_pkhname); $('#txtPackDesc').val(arrData.pkh_pkhname);                       
                        if (arrData.pkh_pkhisimmpack === 'Y') {
                            $('#lblImPack').val('Yes'); 
                        } else if (arrData.pkh_pkhisimmpack === 'N') {
                            $('#lblImPack').val('No'); 
                        }
                        $('#ddlImPack').val(arrData.pkh_pkhisimmpack);
                        $('#lblGSTCodeSup').val(arrData.pkh_pkhgstsupptaxcode); $('#ddlGSTCodeSup').val(arrData.pkh_pkhgstsupptaxcode);                         
                        if (arrData.pkh_pkhisactive === 'Y') {
                            $('#lblStatus').val('Active'); 
                        } else if (arrData.pkh_pkhisactive === 'N') {
                            $('#lblStatus').val('Inactive'); 
                        }
                        $('#ddlStatus').val(arrData.pkh_pkhisactive); 
                        $('#lblCGRP').val(arrData.pkh_pkhcgrp); $('#ddlCGRP').val(arrData.pkh_pkhcgrp); 
$('#lblACCGRP').val(arrData.pkreportgroup); $('#ddlACCGRP').val(arrData.pkreportgroup); 
                        if (arrData.pkh_pkhiscourse === 'Y') 
                            $('#chkCourse').prop('checked', true);                            
                        else
                            $('#chkCourse').prop('checked', false);   
                        $('#chkCourse').val(arrData.pkh_pkhiscourse);
                        $('#txtCourse').val(arrData.pkh_pkhcoursetimes);
                        $('#lblPrice1').val(arrData.pkh_pkhprice); $('#txtPrice1').val(arrData.pkh_pkhprice); 
                        $('#lblPrice2').val(arrData.pkh_pkhprice2); $('#txtPrice2').val(arrData.pkh_pkhprice2); 
                        $('#lblPrice3').val(arrData.pkh_pkhprice3); $('#txtPrice3').val(arrData.pkh_pkhprice3); 
                        $('#lblPrice4').val(arrData.pkh_pkhprice4); $('#txtPrice4').val(arrData.pkh_pkhprice4);     
                    }
                }); 
                
                //get package detail 
                $.ajax({
                    type:'POST',
                    url:"${pageContext.request.contextPath}/Servlet_ChargePackage",
                    data:  {
                        SFC: 'GET_PACKAGE_DETAIL', 
                        PACKCODE: sParam.PACKCODE
                    },
                    dataType: 'json',
                    success: function(data) {  
                        for (var i=0 ; i<data.object1.length ; i++) {
                            var arrData = data.object1[i];
                            
                            $("#tbItem tbody").append("<tr id=tr" + curRow + ">" +                                                 
                                "<td><a style='cursor:pointer;' onclick='showRemovePopup("+curRow+")'><i class='fa fa-fw fa-lg fa-trash-o'/></a>"+
                                "&nbsp;<a style='cursor:pointer;' onclick='PackItemPopup("+curRow+")'><i class='fa fa-fw fa-lg fa-pencil'/></a></td>" +
                                "<td><input type='text' class='form-control' readonly ID='txtItemCode" + curRow + "' name='txtItemCode' style='width:100px' /></td>" +             
                                "<td><input type='text' class='form-control' readonly ID='txtItemDesc" + curRow + "' name='txtItemDesc' style='width:120px' /></td>" +
                                "<td><input type='text' class='form-control' readonly ID='txtItemGrp" + curRow + "' name='txtItemGrp' style='width:80px' /></td>" +
                                "<td><input type='text' class='form-control' readonly ID='txtItemCat" + curRow + "' name='txtItemCat' style='width:80px' /></td>" +
                                "<td><input type='text' class='form-control' readonly ID='txtItemPrice" + curRow + "' name='txtItemPrice' style='width:80px' /></td>" +             
                                "<td><input type='text' class='form-control' readonly ID='txtRemark" + curRow + "' name='txtRemark' style='width:118px' /></td>" +
                                "<td><input type='hidden' class='form-control' ID='txtFunction" + curRow + "' name='txtFunction' value='UPDATE'/></td>" + 
                                "</tr>"
                            );        
                            $("#txtItemCode"+ curRow).val(arrData.pkditemcode);
                            $("#txtItemDesc"+ curRow).val(arrData.ci_cidesc);
                            $("#txtItemGrp"+ curRow).val(arrData.pkditemgroup);
                            $("#txtItemCat"+ curRow).val(arrData.pkditemcategory);
                            $("#txtItemPrice"+ curRow).val(arrData.ItemPrice);
                            $("#txtRemark"+ curRow).val(arrData.pkdremark);
                            curRow = curRow + 1;  
                        }                       
                        calculateOriTotalPrice();
                    }
                });               

                $("#chkCourse").click(function(){
                    if ( $('#chkCourse').is(":checked") ) {
                        $('#chkCourse').val('Y');
                    } else if ( $('#chkCourse').is(":unchecked") )
                        $('#chkCourse').val('N'); {
                    }
                });
                
                //get tab name (category)
                $.ajax({
                    type: "GET",
                    url: "${pageContext.request.contextPath}/Servlet_PopulateData?SFC=GET_DLL",
                    data: {
                        METHOD: "GET_CODETYPE_HIS",
                        P1: "'EXM','INV','OTH','TRM'",
                        P2: ""
                    },
                    dataType: 'json',
                    success: function(data) { 
                        for(var i=1; i<=data.length; i++) {
                            $("#tab"+i).html(data[i-1].TEXT);
                        }
                    }
                });                
                            
                $("a").on("click", function(){
                    var category = "";
                    for (var i=1 ; i<=4 ; i++) {
                        if (this.id === 'tab1') { 
                            category = 'EXM';
                        } else if (this.id === 'tab2') { 
                            category = 'INV';
                        } else if (this.id === 'tab3') { 
                            category = 'OTH';
                        } else if (this.id === 'tab4') { 
                            category = 'TRM';
                        }
                    }
                    $("#jqgridPrdList").jqGrid('setGridParam', {
                        postData: {
                            SFC: 'GET_CHGITEM_LIST',    
                            CATEGORY: category,
                            CODE: "",
                            DESC: ""
                        }
                    }).trigger("reloadGrid", [{page: 1}]);  
                });   
                
                $("#btnSave").click(function(){
                    if ( $(this).val() === 'Edit Detail') { 
                        enableEdit();
                    }
                    else if ( $(this).val() === 'Save') { 
                        //valid01
                        var $validForm = $("#form_PackageHdrDetail").valid();
                        var $validCourse = intNum($("#txtCourse").val());
                        var $validPrice1 = doubleNum($("#txtPrice1").val());
                        var $validPrice2 = doubleNum($("#txtPrice2").val());
                        var $validPrice3 = doubleNum($("#txtPrice3").val());
                        var $validPrice4 = doubleNum($("#txtPrice4").val());
                        var PackItem = new Array();
                        $('#tbItem tr').each(function (row, th) {                
                            if (row > 0) {       
                                PackItem[row-1] = {
                                    "ITEMCODE": $(this).find("input[name=txtItemCode]").val(),
                                    "ITEMGROUP": $(this).find("input[name=txtItemGrp]").val(),
                                    "ITEMCATEGORY": $(this).find("input[name=txtItemCat]").val(),                                    
                                    "ITEMPRICE": $(this).find("input[name=txtItemPrice]").val(),
                                    "REMARK": $(this).find("input[name=txtRemark]").val(),
                                    "FUNCTION": $(this).find("input[name=txtFunction]").val() 
                                };
                            }
                        });           
                        var ItemToSend = JSON.stringify(PackItem);
                        //alert(ItemToSend);
                        //c01
                        //valid01
                        if ($validForm === true && $validCourse === true && $validPrice1 === true && $validPrice2 === true && $validPrice3 === true && $validPrice4 === true){
                            document.getElementById("btnSave").disabled = true;
                            showYesNo({
                                title: "Confirmation needed",
                                width: 420,
                                noClose: true,
                                isModal: true,
                                body: [
                                    "<br><h4>Please confirm all the details entered.<h4><br>"
                                ],
                                show: function(){},
                                Yes: {
                                    text: "Yes",
                                    opt: function(){
                                        savePackage(ItemToSend);
                                        hideYesNo();
                                    }
                                },
                                No: {
                                    text: "No",
                                    opt: function(){
                                        document.getElementById("btnSave").disabled = false;
                                        hideYesNo();
                                    }
                                }
                            });
                        }
                        //valid01
                        else if ($validPrice1 === false || $validPrice2 === false || $validPrice3 === false || $validPrice4 === false){
                            $.bigBoxFail({
                                title: "Invalid Inputs.",
                                content: "Please enter a valid input for:<br>1. Price 1<br>2. Price 2<br>3. Price 3<br>Price 4",
                                timeout: 6000
                            });
                        }
                        else if ($validCourse === false){ //valid01
                            $.bigBoxFail({
                                title: "Invalid Course Time.",
                                content: "Please enter a valid course number and try again...",
                                timeout: 6000
                            });
                        }
                    }
                });  
            }); 
            //c01
//                        var request = $.ajax({
//                            type: "POST",
//                            url: "${pageContext.request.contextPath}/Servlet_ChargePackage?SFC=UPDATE_STOCK_PACKAGE",
//                            data: {
//                                ITEMS: ItemToSend,
//                                CODE: $('#txtPackCode').val(),
//                                NAME: $('#txtPackDesc').val(),
//                                PRICE: $('#txtPrice1').val(),
//                                PRICE2: $('#txtPrice2').val(),
//                                PRICE3: $('#txtPrice3').val(),
//                                PRICE4: $('#txtPrice4').val(),
//                                ISACTIVE: $('#ddlStatus').val(),
//                                CGRP: $('#ddlCGRP').val(),
//                                ISIMMPACK: $('#ddlImPack').val(),
//                                ISCOURSE: $('#chkCourse').val(),
//                                COURSETIMES: $('#txtCourse').val(),
//                                GSTCODE: $('#ddlGSTCodeSup').val(),
//                                ACCGRP: $('#ddlACCGRP').val()
//                            },
//                            dataType: 'json'
//                        });    
//                        request.done(function (response) {
//                            if (response.bool === true) {
//                                $.bigBoxSuccess({
//                                    title: "Stock Package Successful.",
//                                    content: "Stock Package Updated Successfully.",
//                                    timeout: 6000
//                                });
//                                setTimeout(function(){location.reload();}, 2000);
//                            } else {
//                                $.bigBoxFail({
//                                    title: "Stock Package FAIL.",
//                                    content: "There is some error during item update.<br> Please try again...",
//                                    timeout: 6000
//                                });
//                            }
//                        });
//                    }
//                });  
//            }); 
            
            loadScript("js/plugin/jqgrid/ui.multiselect.js", function () {
                loadScript("js/plugin/jqgrid/grid.locale-en.min.js", function () {
                    loadScript("js/plugin/jqgrid/jquery.jqGrid.min.js", function () {
                        loadScript("js/column-chooser.js", function () {
                            run_jqgrid_function();
                        });
                    });
                });
            });

            //c01
            function savePackage(items){
                $.ajax({
                            type: "POST",
                            url: "${pageContext.request.contextPath}/Servlet_ChargePackage?SFC=UPDATE_STOCK_PACKAGE",
                            data: {
                        ITEMS: items,
                                CODE: $('#txtPackCode').val(),
                                NAME: $('#txtPackDesc').val(),
                                PRICE: $('#txtPrice1').val(),
                                PRICE2: $('#txtPrice2').val(),
                                PRICE3: $('#txtPrice3').val(),
                                PRICE4: $('#txtPrice4').val(),
                                ISACTIVE: $('#ddlStatus').val(),
                                CGRP: $('#ddlCGRP').val(),
                                ISIMMPACK: $('#ddlImPack').val(),
                                ISCOURSE: $('#chkCourse').val(),
                                COURSETIMES: $('#txtCourse').val(),
                                GSTCODE: $('#ddlGSTCodeSup').val(),
                                ACCGRP: $('#ddlACCGRP').val()
                            },
                    dataType: 'json',
                    beforeSend: function(xhr){
                        $.showLoadingNoStatus();
                    },
                    success: function(response,xhr,status){
                            if (response.bool === true) {
                                $.bigBoxSuccess({
                                    title: "Stock Package Successful.",
                                    content: "Stock Package Updated Successfully.",
                                    timeout: 6000
                                });
                        }
                        else{
                                $.bigBoxFail({
                                    title: "Stock Package FAIL.",
                                    content: "There is some error during item update.<br> Please try again...",
                                    timeout: 6000
                                });
                            }
                    },
                    error: function(xhr,status,error){
                        $.bigBoxFail({
                            title: "Transaction ERROR",
                            content: "There is some error occur during data transfer. Please try again later",
                            timeout: 6000
                        });
                    },
                    complete: function(xhr,status){
                        document.getElementById("btnSave").diabled = false;
                        if (xhr.status === 200) {
                            $.hideLoadingNoStatus(function () {
                               location.reload();
                            }, 500);
                        } else {
                            $.hideLoadingNoStatus(function () {
                            }, 0);
                        }
                    }
                });  
            }
            //c01
            function run_jqgrid_function() {            
                var grid = $("#jqgridPrdList"),
                    gridPager = "#p" + grid.selector.toString().substring(1),
                    conDiv = $("#c" + grid.selector.toString().substring(1)),
                    defaultColName =  [' ','Code','Description','Group','Price','hidCategory'],
                    defaultColMol = [                   
                        {name: '', index: '', formatter: selectCurrentRow, sortable: false, width: 60, align:'center', must:true, hidedlg:true},
                        {name:'ci_cicode', index:'ci_cicode', sortable:true, must:true, hidedlg:true, width:100},
                        {name:'ci_cidesc', index:'ci_cidesc', sortable:true, width:220},
                        {name:'ci_cigroup', index:'ci_cigroup', sortable:true, width:80},
                        {name:'Price', index:'Price', sortable:true, width:80},
                        {name:'ci_cicategory', index:'ci_cicategory', hidden:true}
                    ],             
                    mainGridName = grid.selector.toString().substring(1),
                    //temp = readSettings({settingArray:${sessionScope.settings}, defaultColName: defaultColName, defaultColMol: defaultColMol, settingName: mainGridName});//,
                    temp = readSettings({settingArray:"admin", defaultColName: defaultColName, defaultColMol: defaultColMol, settingName: mainGridName}),
                    currentColName = temp[0],
                    currentColMol = temp[1];
                    // alert(JSON.stringify(temp));
                grid.jqGrid({
                    url: '${pageContext.request.contextPath}/Servlet_ChargeItem',
                    postData: {
                        SFC: 'GET_CHGITEM_LIST',
                        CATEGORY: "EXM",
                        CODE: "",
                        DESC: ""
                    },
                    datatype: "json",
                    mtype: 'POST',
                    colNames: currentColName,
                    colModel: currentColMol,
                    gridview: true,
                    rownumWidth: 40,
                    rowNum: 10,
                    rowList: [10, 20, 25, 30, 50, 100],
                    pager: gridPager,
                    sortname: '',
                    viewrecords: true,
                    sortorder: '',
                    toolbarfilter: true,
                    autowidth: true,
                    shrinkToFit: true,
                    loadonce: false,
                    height: 'auto',
                    scrollerbar: false,  
                    //rownumbers: true,
                    celledit: true,
                    async: true,
                    sortable: {
                        update: function (relativeColumnOrder) {
                            //sortColumn({settingArray:${sessionScope.settings}, order: relativeColumnOrder, grid: grid, defaultColMol: defaultColMol, settingName: mainGridName});
                            sortColumn({settingArray:"admin", order: relativeColumnOrder, grid: grid, defaultColMol: defaultColMol, settingName: mainGridName});
                        }
                    },
                    loadComplete: function () {
                        var iLastPage = parseInt($(this).getGridParam('lastpage'));
                        $(".ui-jqgrid .ui-pg-input").keydown(function (e) {
                            this.value = this.value.replace(/\D/g, '');
                            var code = e.keyCode || e.which;
                            if (code === 13) {
                                if (this.value > iLastPage) {
                                    this.value = iLastPage;
                                } else if (this.value <= 0) {
                                    this.value = 1;
                                }
                            }
                        });
                    }
                });        
                function selectCurrentRow(cellvalue, options, rowObject) {               
                    return "<input type='button' id='btnSelRow' name='btnSelRow' style='cursor:pointer; width:45px; height:20px;' value='Select' title='Select' onclick='SelectRow(\"" + options.rowId + "\")'/>";                    
                }
                // remove classes
                $(".ui-jqgrid").removeClass("ui-widget ui-widget-content");
                $(".ui-jqgrid-view").children().removeClass("ui-widget-header ui-state-default");
                $(".ui-jqgrid-labels, .ui-search-toolbar").children().removeClass("ui-state-default ui-th-column ui-th-ltr");
                $(".ui-jqgrid-pager").removeClass("ui-state-default");
                $(".ui-jqgrid").removeClass("ui-widget-content");
                // add classes
                $(".ui-jqgrid-htable").addClass("table table-bordered table-hover");
                $(".ui-jqgrid-btable").addClass("table table-bordered table-striped");
                $(".ui-pg-div").removeClass().addClass("btn btn-sm btn-primary");
                $(".ui-icon.ui-icon-plus").removeClass().addClass("fa fa-plus");
                $(".ui-icon.ui-icon-pencil").removeClass().addClass("fa fa-pencil");
                $(".ui-icon.ui-icon-trash").removeClass().addClass("fa fa-trash-o");
                $(".ui-icon.ui-icon-search").removeClass().addClass("fa fa-search");
                $(".ui-icon.ui-icon-refresh").removeClass().addClass("fa fa-refresh");
                $(".ui-icon.ui-icon-disk").removeClass().addClass("fa fa-save").parent(".btn-primary").removeClass("btn-primary").addClass("btn-success");
                $(".ui-icon.ui-icon-cancel").removeClass().addClass("fa fa-times").parent(".btn-primary").removeClass("btn-primary").addClass("btn-danger");
                $(".ui-icon.ui-icon-seek-prev").wrap("<div class='btn btn-sm btn-default'></div>");
                $(".ui-icon.ui-icon-seek-prev").removeClass().addClass("fa fa-backward");
                $(".ui-icon.ui-icon-seek-first").wrap("<div class='btn btn-sm btn-default'></div>");
                $(".ui-icon.ui-icon-seek-first").removeClass().addClass("fa fa-fast-backward");
                $(".ui-icon.ui-icon-seek-next").wrap("<div class='btn btn-sm btn-default'></div>");
                $(".ui-icon.ui-icon-seek-next").removeClass().addClass("fa fa-forward");
                $(".ui-icon.ui-icon-seek-end").wrap("<div class='btn btn-sm btn-default'></div>");
                $(".ui-icon.ui-icon-seek-end").removeClass().addClass("fa fa-fast-forward");
                $(".ui-pg-input").addClass("pg-input");

                // resize
                $(window).on('resize', function () {
                    grid.jqGrid('setGridWidth', conDiv.width());
                });
                grid.on('myRefresh', function () {
                    resizeWidth({grid: grid, gridDiv: conDiv});
                });
                // quickSetupChooser({grid: grid, defaultColMol: defaultColMol, settingName: mainGridName,
                // settingArray:${sessionScope.settings},
                quickSetupChooser({grid: grid, defaultColMol: defaultColMol, settingName: mainGridName,
                    settingArray:"admin",
                    done: function () {
                        resizeWidth({grid: grid, gridDiv: conDiv});
                    }
                });
                grid.jqGrid('setGridWidth', conDiv.width());                
            };
        };      
        pagefunction();
        
        function enableEdit() {
            $.showLoadingNoStatus();
                        
            document.getElementById('lblPackDesc').style.display = 'none';
            document.getElementById('txtPackDesc').style.display = '';

            document.getElementById('lblImPack').style.display = 'none';
            document.getElementById('selectImPack').style.display = '';

            document.getElementById('lblGSTCodeSup').style.display = 'none';
            document.getElementById('selectGSTCodeSup').style.display = '';

            document.getElementById('lblStatus').style.display = 'none';
            document.getElementById('selectStatus').style.display = '';

            document.getElementById('lblCGRP').style.display = 'none';
            document.getElementById('selectCGRP').style.display = '';
            
            document.getElementById('lblACCGRP').style.display = 'none';
            document.getElementById('selectACCGRP').style.display = '';
            
            document.getElementById('lblPrice1').style.display = 'none';
            document.getElementById('txtPrice1').style.display = '';
            
            document.getElementById('lblPrice2').style.display = 'none';
            document.getElementById('txtPrice2').style.display = '';

            document.getElementById('lblPrice3').style.display = 'none';
            document.getElementById('txtPrice3').style.display = '';

            document.getElementById('lblPrice4').style.display = 'none';
            document.getElementById('txtPrice4').style.display = '';        

            document.getElementById('wid-id-3').style.display = '';  
            document.getElementById('wid-id-5').style.display = '';  
            document.getElementById('wid-id-4').style.display = '';  
            
            $('#chkCourse').prop('disabled', false);
            $('#txtCourse').prop('disabled', false);
            $('#btnSave').val('Save');           
            
            $.hideLoadingNoStatus();
        }                
    }
       
    function SelectRow(ids) { 
        var grid = $('#jqgridPrdList');       
        var ItemCode = grid.jqGrid('getCell', ids, 'ci_cicode');       
        var ItemDesc = grid.jqGrid('getCell', ids, 'ci_cidesc');
        var ItemGrp = grid.jqGrid('getCell', ids, 'ci_cigroup');
        var ItemCat = grid.jqGrid('getCell', ids, 'ci_cicategory');
        var ItemPrice = grid.jqGrid('getCell', ids, 'Price');
        var bAppend = true;
        $('#tbItem tr').each(function (row, th) {                
            if (row > 0) {                
                var rowid = $(this).closest('tr').attr('id');  
                var rowno = rowid.substring(2);
                var curItemCode = $('#txtItemCode'+rowno).val();
                if (curItemCode === ItemCode){
                    bAppend = false; 
                    $.bigBoxWarning({
                        title: "Item Selection.",
                        content: "Some items have already been selected previously.",
                        timeout: 3000
                    });
                    return false;
                }     
            }
        });           
        if (bAppend) {
            $("#tbItem tbody").append("<tr id=tr" + curRow + ">" +                                                 
                "<td><a style='cursor:pointer;' onclick='showRemovePopup("+curRow+")'><i class='fa fa-fw fa-lg fa-trash-o'/></a>"+
                "&nbsp;<a style='cursor:pointer;' onclick='PackItemPopup("+curRow+")'><i class='fa fa-fw fa-lg fa-pencil'/></a></td>" +
                "<td><input type='text' class='form-control' readonly ID='txtItemCode" + curRow + "' name='txtItemCode' style='width:100px' /></td>" +             
                "<td><input type='text' class='form-control' readonly ID='txtItemDesc" + curRow + "' name='txtItemDesc' style='width:120px' /></td>" +
                "<td><input type='text' class='form-control' readonly ID='txtItemGrp" + curRow + "' name='txtItemGrp' style='width:80px' /></td>" +
                "<td><input type='text' class='form-control' readonly ID='txtItemCat" + curRow + "' name='txtItemCat' style='width:80px' /></td>" +
                "<td><input type='text' class='form-control' readonly ID='txtItemPrice" + curRow + "' name='txtItemPrice' style='width:80px' /></td>" +             
                "<td><input type='text' class='form-control' readonly ID='txtRemark" + curRow + "' name='txtRemark' style='width:118px' value='' /></td>" +
                "<td><input type='hidden' class='form-control' ID='txtFunction" + curRow + "' name='txtFunction' value='INSERT'/></td>" + 
                "</tr>"
            );        
            $("#txtItemCode"+ curRow).val(ItemCode);
            $("#txtItemDesc"+ curRow).val(ItemDesc);
            $("#txtItemGrp"+ curRow).val(ItemGrp);
            $("#txtItemCat"+ curRow).val(ItemCat);
            $("#txtItemPrice"+ curRow).val(ItemPrice);
            curRow = curRow + 1;           
        }
        calculateOriTotalPrice();
    }
    
    function showRemovePopup(rowId) {
        showYesNo({
            title: "Are you sure to remove the particular item?",
            width: 520,
            _HtmlBody:
                "<table class='selection-criteria' style='width:100%' >" +
                "<tr><td align='center'>" +
                "<button style='width:180px' class='btn btn-default bg-color-blueDark txt-color-white' onclick='DeleteRow("+rowId+")';>Yes</button>" +
                "</td><td align='center'>" +
                "<input type='button' Id='btnCloseDelete' class='btn btn-default bg-color-blueDark txt-color-white' value='No' style=' width: 180px;' data-dismiss='modal' />" +
                "</td>" +
                "</tr>" +
                "</table>",
            Yes: false,
            No: false
        });  
    }
    
    function DeleteRow(rowId) {
        $('table#tbItem tr#tr' + rowId).remove();
        calculateOriTotalPrice();
        hideYesNo(true);       
    }
    
    function PackItemPopup(row) {   
        curRowToEdit = row;
        $("#lblPckCode").text($("#txtPackCode").val());
        $("#lblPckDesc").text($("#txtPackDesc").val());
        $("#lblChgCode").text($("#txtItemCode"+row).val());
        $("#lblChgDesc").text($("#txtItemDesc"+row).val());
        $("#lblChgGrp").text($("#txtItemGrp"+row).val());
        $("#lblChgCat").text($("#txtItemCat"+row).val());
        $("#txtChgPrice").val($("#txtItemPrice"+row).val());  
        $("#txtRemark").val($("#txtRemark"+row).val());
        $("#myModal2").modal("show"); 
    }
    
    $("#btnOK").click(function(){       
        //valid01
        //validate charge price to allow 3 decimal places only
        var $validItem = doubleNum($("#txtChgPrice").val());
        if ($validItem === true){
        $("#txtItemPrice"+curRowToEdit).val($("#txtChgPrice").val()); 
        $("#txtRemark"+curRowToEdit).val($("#txtRemark").val()); 
        calculateOriTotalPrice();
        }
        else{
            $.bigBoxFail({
                title: "INVALID Price",
                content: "Please enter a valid price and try again...",
                timeout: 6000
            });
        }
        
    });
    
    function calculateOriTotalPrice() {
        var oriTotalPrice = 0.00;
        $('#tbItem tr').each(function (row, th) {                
            if (row > 0) {                
                var rowid = $(this).closest('tr').attr('id');  
                var rowno = rowid.substring(2);
                var itemPrice = parseFloat($('#txtItemPrice'+rowno).val());
                oriTotalPrice = oriTotalPrice + itemPrice;
            }
        });            
        $('#lblOriPrice').val(oriTotalPrice.toFixed(2));
    }
        
    //valid01
    function intNum(num){
        var reg = /^[0-9]+$/;
        if (num === ""){
            return true;
        }
        else{
            return reg.test(num);
        }
    }
    
    //valid01
    function doubleNum(num){
        var reg = /^[0-9]+(\.[0-9][0-9]?[0-9]?)?$/;
        if (num === ""){
            return true;
        }
        else{
            return reg.test(num);
        }
    }
        
</script>
