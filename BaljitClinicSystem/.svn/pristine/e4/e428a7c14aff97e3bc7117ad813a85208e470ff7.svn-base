<%@taglib prefix="jstl" uri="http://java.sun.com/jsp/jstl/core" %>
<jsp:useBean id="DDL" scope="page" class="BusinessLogic.Servlet_PopulateData" />
<link rel="stylesheet" type="text/css" href="css/your_style.css" />
<link rel="stylesheet" type="text/css" href="js/plugin/jqgrid/ui.multiselect.css" />
<section id="widget-grid" class="">
    <!--<input type="text" id="lblUserCode" value="<%= session.getAttribute("s_usercode")%>"  class="tboxreadonlyShort"/>-->
    <input type="hidden" id="lblCompCode" value="<%= session.getAttribute("CompCode")%>"  class="tboxreadonlyShort"/>
    <input type="hidden" id="lblLocCode" value="<%= session.getAttribute("LocCode")%>"  class="tboxreadonlyShort"/>
    <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
        <h1 class="page-title txt-color-blueDark">
            <!-- PAGE HEADER -->
            <i class="fa-fw fa fa-file fa-2x"></i> 
            Purchase Order Report                                   
        </h1>
    </div>
    <div class="row">
        <form id='form_PO_Report'>
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-2"  data-widget-editbutton="false" data-widget-colorbutton="false" data-widget-fullscreenbutton="false" data-widget-custombutton="false" data-widget-deletebutton="false">
                <header>
                    <span class="widget-icon"> <i class="fa fa-search"></i></span>
                    <span><h2>&nbsp;Generate Purchase Order Report</h2></span>
                </header>
                <div class="no-padding">
                    <div class="widget-body">
                        <div id="selectCriTab" class="tab-content">
                            <div class="tab-pane fade active in padding-5 no-padding-bottom" id="selectCriTab_s1">
                                <table id="tblSearch" class="selection-criteria">
                                    <tr>
                                        <td width="15%">PO Date:</td>
                                        <td width="20%"><input id="txtPODateFrom" name="txtPODateFrom" placeholder="PO Date" class="searchbox-date"/></td>
                                        <td width="5%" align="center">To</td>
                                        <td width="60%"><input id="txtPODateTo" name="txtPODateTo" placeholder="PO Date" class="searchbox-date"/></td>
                                    </tr>    
                                    <tr>
                                        <td>PO No:</td>
                                        <td>
                                            <input type="text" id="txtPONo" name="txtPONo" class="form-control" placeholder="Enter PO No."/>
<!--                                            <button type="button" id="btnSearchPO" class='btn btn-default bg-color-blueDark txt-color-white' onclick="searchGRN();"><i class="fa fa-search fa-lg"></i></button>-->
                                        </td>
                                        <td colspan="2"></td>
                                    </tr>
                                     <tr>
                                        <td>Company:</td>
                                        <td>                                            
                                            <select class="form-control" id="ddlComp" name="ddlComp" style="width:300px;">
                                                <option value="">- Select Company -</option>
                                                <jstl:forEach var="ddl_Comp" items="${DDL.ddlGet('GET_COMP', '', '', sessionScope.SiteName)}">
                                                    <option value="${ddl_Comp.VALUE}">${ddl_Comp.TEXT}</option>
                                                </jstl:forEach>     
                                            </select>    
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Location:</td>
                                        <td>                                            
                                            <select class="form-control" id="ddlLoc" name="ddlLoc" style="width:300px;">
                                                <option value="">- Select Location -</option>
                                                <jstl:forEach var="ddl_Loc" items="${DDL.ddlGet('GET_LOCATION', '', '', sessionScope.SiteName)}">
                                                    <option value="${ddl_Loc.VALUE}">${ddl_Loc.TEXT}</option>
                                                </jstl:forEach>  
                                            </select>    
                                        </td>                                                                          
                                    </tr>                                       
<!--                                    <tr>
                                        <td>Stock/Product:</td>
                                        <td colspan="3">
                                            <input type="text" id="txtPrdCode" name="txtPrdCode"  placeholder="Enter Product Code" class="searchbox-text" style="width:250px;margin-right:8px;"/>
                                            <button class='btn btn-default bg-color-blueDark txt-color-white' type="button" onclick="searchProduct();" ><i class="fa fa-search fa-lg"></i></button>
                                        </td>
                                    </tr>-->
                                    <tr>
                                        <td>Supplier:</td>
                                        <td>
                                            <select class="form-control" id="ddlSupplier" required name="ddlSupplier" style="width:300px;">
                                                <option value="">- Select Supplier -</option>
                                                <jstl:forEach var="ddl_Supplier" items="${DDL.ddlGet('GET_SUPPLIER', '', '', sessionScope.SiteName)}">
                                                    <option value="${ddl_Supplier.VALUE}">${ddl_Supplier.TEXT}</option>
                                                </jstl:forEach>                                             
                                            </select> 
                                        </td>   
                                    </tr>                                                                                                   
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>                            
        </article>
        </form>                             
    </div>
    <div class="row" style="padding-left:20px;padding-bottom:20px;">
        <div align="center" class="padding-5" >
            <input type="button" class="btn btn-default bg-color-blueDark txt-color-white" id="btnPrintPrev" name="btnPrintPrev" onclick="LoadPrintPreview();" data-toggle='modal' data-target='#printPreview' value="Print Preview" style="margin-right:20px;"/>
            <input type="button" class="btn btn-default bg-color-blueDark txt-color-white" id="btnCancel" name="btnCancel" onclick="$('#form_PO_Report').trigger('reset');" value="Cancel" style="margin-right:20px"/>
        </div>
    </div>
</section>
<jsp:include page="../../../includes/loading-no-status.jsp"/>  
<jsp:include page="../../../includes/PopUpInitPage.jsp"/>
<script src="js/buttonset.js"></script>
<script type="text/javascript">
   
    pageSetUp();

    function searchGRN() { 
        showGRN({width: 1000, height: 600}).done(function (rowIn) {
            $("#txtPONo").val(rowIn.GRN_No);
            //$("#hidGRNID").val(rowIn.sgrh_grnhdridx);                         
        });
    }
    
    function searchProduct() {
        showProduct({width: 800, height: 600}).done(function (rowIn) {
            //alert(JSON.stringify(rowIn));
            //$("#txtPrdDesc").val(rowIn.stk_desc);
            $("#txtPrdCode").val(rowIn.stk_stockcode);
        });
    }
    
    $().ready(function(){
        $("#ddlLoc").prop("disabled", true);     
        
        var tempDate = new Date();
        $("#txtPODateFrom").datepicker({
            numberOfMonths: 2,
            changeMonth: true,
            changeYear: true,
            dateFormat: "yy-mm-dd",
            prevText: '<i class="fa fa-chevron-left"></i>',
            nextText: '<i class="fa fa-chevron-right"></i>',
            onSelect: function (selected) {
                $("#txtPODateTo").datepicker("option", "minDate", selected);
            }
        });
        var fromDate = $.datepicker.formatDate('yy-mm-dd', new Date(tempDate.getFullYear(), tempDate.getMonth() - 6, tempDate.getDate()));
        $("#txtPODateFrom").val(fromDate);
        $("#txtPODateTo").datepicker({
            numberOfMonths: 2,
            changeMonth: true,
            changeYear: true,
            dateFormat: "yy-mm-dd",
            prevText: '<i class="fa fa-chevron-left"></i>',
            nextText: '<i class="fa fa-chevron-right"></i>',
            onSelect: function (selected) {
                $("#txtPODateFrom").datepicker("option", "maxDate", selected);
            }
        });
        $("#txtPODateTo").datepicker("option", "minDate", fromDate);
        $("#txtPODateTo").val($.datepicker.formatDate('yy-mm-dd', tempDate));
        $("#txtPODateFrom").datepicker("option", "maxDate", tempDate);     
        
        $("#ddlComp").change(function(){             
            $('#ddlLoc').empty();            
            var sCompany = this.value;
            if (sCompany !== "") {                
                $.ajax({
                    type: "GET",
                    url: "${pageContext.request.contextPath}/Servlet_Stock?SFC=GET_REL_LOCATION",
                    data: { COMPANY: sCompany },
                    dataType: 'json',
                    success: function(data) {
                        $("select#ddlLoc").append( $("<option>").val("").html("- Select Location -")); 

                        for (var a=0 ; a<data.object1.length ; a++) {                   
                            var arrData = data.object1[a];                
                            $("select#ddlLoc").append( $("<option>")
                                .val(arrData.VALUE)
                                .html(arrData.TEXT)
                            ); 
                        }
                    }
                });                                                           
                $("#ddlLoc").prop("disabled", false); 
            } else 
                $("select#ddlLoc").append( $("<option>").val("").html("- Select Location -")); 
        });            
    });    

    function LoadPrintPreview() {
        loadScript("js/print-preview.js", function () {          
            var jObj = {              
                1: "GET_PO_REPORT",
                2: $('#txtPODateFrom').val(), 
                3: $('#txtPODateTo').val(), 
                4: $('#ddlLoc').val(),
                5: $('#ddlSupplier').val(), 
                6: $('#txtPONo').val()
            }; 
            
            var param = {};                       
            var object = {};
            object.procParam = jObj;
            object.jasperName = 'PO_Report';
            object.procString = 'SP_GET_PO_RPT(?,?,?,?,?,?)';
            object.fixParam = param;
            printToPage(object);                                           
        });      
    };
        
</script>
